{"_path":"/posts/slackwarevim-crontab-not-saving-fix","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Slackware/Vim crontab not saving fix.","description":"Tutorial: How to ensure that Slackware saves the crontab when using Vim.","imagesource":null,"imagecredit":null,"image":"2012.02.09T150000_slackwarevim-crontab-not-saving-fix.jpg","createdAt":"2012-02-09T15:00:00","updatedAt":"2012-02-09T15:00:00","readingTime":{"text":"1 min read","minutes":0.02,"time":1200,"words":4},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hi folks!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Off the electronics and back to Linux for a second... I was trying to reconfigure root's crontab on one of my Slackware servers, and found that when using Vim, it wouldn't save. I couldn't see any errors printed to the screen, but it silently failed, and left me with my old crontab in place. What seemed odd, was that on an Ubuntu server, it worked absolutely fine, and when using vi as the crontab editor (export EDITOR=vi && export VISUAL=vi), it also worked fine on the Slackware box. Now while vi deserves a lot of respect for being the basis for Vim, it's also a total and utter cow to use, so it wasn't an option to revert to vi."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After a little research, the problem turned out to be thanks to Slackware's vimrc. It's set to save a backup containing the file's previous state whenever saved (and this has saved my day numerous times!). However this causes problems with crontab -e. This is described in Vim's help on crontab (:help crontab) as follows:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"        One situation where \"no\" and \"auto\" will cause problems: A program"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        that opens a file, invokes Vim to edit that file, and then tests if"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        the open file was changed (through the file descriptor) will check the"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        backup file instead of the newly created file.  \"crontab -e\" is an"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        example."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"        When a copy is made, the original file is truncated and then filled"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        with the new text.  This means that protection bits, owner and"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        symbolic links of the original file are unmodified.  The backup file"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        however, is a new file, owned by the user who edited the file.  The"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        group of the backup is set to the group of the original file.  If this"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        fails, the protection bits for the group are made the same as for"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        others."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"        When the file is renamed this is the other way around: The backup has"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        the same attributes of the original file, and the newly written file"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        is owned by the current user.  When the file was a (hard/symbolic)"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        link, the new file will not!  That's why the \"auto\" value doesn't"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        rename when the file is a link.  The owner and group of the newly"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"        written file will be set to the same ones as the original file, but"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        the system may refuse to do this.  In that case the \"auto\" value will"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n        again not rename the file."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To turn off the backup file function, you can either change your vimrc if you want a permanent change, or once you're editing the file, use the following commands (press : first)..."}]},{"type":"element","tag":"div","props":{"className":["geshifilter"]},"children":[{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"set nobackup\nset nowritebackup\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" nobackup\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"set"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" nowritebackup\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once you've done this, you should see that the problem goes away nicely!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"n00b"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:2012-02-09-slackwarevim-crontab-not-saving-fix.md","_source":"content","_file":"posts/2012-02-09-slackwarevim-crontab-not-saving-fix.md","_stem":"posts/2012-02-09-slackwarevim-crontab-not-saving-fix","_extension":"md"}