{"_path":"/posts/optimising-slackware-boot-time-part-2","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Optimising Slackware Boot Time (part 2).","description":"Part 2 of Optimising Slackware Boot Time","imagesource":"https://commons.wikimedia.org/wiki/File:Kernel-panic.jpg","imagecredit":"Kevin Collins","imageFilename":"2009.02.21T150000_optimising-slackware-boot-time-part-2.jpg","createdAt":"2009-02-21T15:00:00","updatedAt":"2009-02-21T15:00:00","readingTime":{"text":"1 min read","minutes":0.375,"time":22500,"words":75},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Welcome to part two of my in depth guide to speeding up the Slackware boot time. Time to install the OS..."}]},{"type":"element","tag":"h1","props":{"id":"installing-the-os"},"children":[{"type":"text","value":"Installing the OS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm not going to walk you through this, as there are enough resources online for doing this (try "},{"type":"element","tag":"a","props":{"href":"http://www.howtoforge.com/the_perfect_desktop_slackware12"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"). Basically, I use the verbose mode, and carefully decide what I will and what I won't need. Slackware comes with about 15 of everything by default, so just limit it to one text editor, no office suite, ignore all X Windows based networking components etc... I tend to include everything in the /l folder, because it adds up to very little usage of space, but allows the addition of packages without too much hassle if necessary. Like I say... If you don't NEED it, don't install it. If you are a newbie to Slackware be particularly careful with the x/ folder, as you can b0rk it extremely easily... If in doubt, say yes (that's my motto, anyway!)."}]},{"type":"element","tag":"h1","props":{"id":"the-interesting-bit-begins"},"children":[{"type":"text","value":"The interesting bit begins"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once you've booted your new system and logged in as root, the first step is to download a kernel, or at least reconfigure the existing source. Yet again, a full description of the process involved here is way beyond the scope of this article. Check out Alien Bob's wiki page on it "},{"type":"element","tag":"a","props":{"href":"http://alien.slackbook.org/dokuwiki/doku.php?id=linux:kernelbuilding&s%5B%5D=kernel"},"children":[{"type":"text","value":"here"}]},{"type":"text","value":" if you're not sure what you're doing."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ok... The key with building your kernel is ONLY compiling into the kernel things your system requires. The default kernel has support for almost everything - hence it's name being vmlinuz-huge-smp. This may take a few attempts to get it spot on (for few attempts read BLOODY AGES), so make sure you leave the previous kernel selection in your lilo.conf. Generally, I'm happy when the kernel's no bigger than about 1.5-2Mb, as the time LILO will take to load a kernel of this size is negligible."}]},{"type":"element","tag":"h1","props":{"id":"initrdinitramfs"},"children":[{"type":"text","value":"InitRD/InitRAMFS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use such things as the bootsplash patch, you will require an InitRD or InitRAMFS. These are just as hackable as the rest of the operating system. The file you will want to look at in your InitRD is the file called simply \"init\". This is the script which is run on loading of the initrd."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The idea with hacking apart your init script is to remove any lines in the script which you do not need. If you don't need RAID support on boot take out the mdadm clause, if you're not loading any kernel modules then delete the /lib/modules clause... All of these modifications will make a small difference... It may only be a tiny difference for each removal, but that's all we need."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also, when leaving sections in, try to avoid leaving sections within conditional clauses. As an example, if you require LUKS filesystem encryption in your initrd, then it is quite likely that the cryptsetup executable will be executable, and that you know that your enrypted volume is valid. The original section looks like this:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"  CRYPTDEV=\"\"\n  if [ -x /sbin/cryptsetup ]; then\n    # If we find a LUKS device now, it is on a real block device:\n    if /sbin/cryptsetup isLuks ${LUKSDEV} 1&amp;gt;/dev/null 2&amp;gt;/dev/null ; then\n      CRYPTDEV=$(basename $ROOTDEV)\n      echo \"Unlocking LUKS crypt volume '${CRYPTDEV}' on device '$LUKSDEV':\"\n      /sbin/cryptsetup luksOpen ${LUKSDEV} $CRYPTDEV /dev/systty 2&amp;gt;&amp;1\n      if [ \"$CRYPTDEV\" == \"$ROOTDEV\" ]; then # scenario 1\n        ROOTDEV=\"/dev/mapper/${CRYPTDEV}\"\n      fi\n    fi\n  fi\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"  CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"-x"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" /sbin/cryptsetup ]; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"then\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"    # If we find a LUKS device now, it is on a real block device:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" /sbin/cryptsetup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" isLuks"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ${LUKSDEV} "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"/dev/null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" 2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"/dev/null"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"then\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"      CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"basename"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" $ROOTDEV)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"      echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \"Unlocking LUKS crypt volume '${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"}' on device '"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$LUKSDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"':\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"      /sbin/cryptsetup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" luksOpen"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ${LUKSDEV} $CRYPTDEV "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"/dev/systty"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" 2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"      if"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" =="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$ROOTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ]; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":" # scenario 1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        ROOTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"/dev/mapper/${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"}\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"      fi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    fi\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"  fi\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This can be happily hacked to pieces in the following manner:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"CRYPTDEV=$(basename $ROOTDEV)\n/sbin/cryptsetup luksOpen ${LUKSDEV} $CRYPTDEV /dev/systty 2&amp;gt;&amp;1\n[ \"$CRYPTDEV\" == \"$ROOTDEV\" ] &amp;&amp; ROOTDEV=\"/dev/mapper/${CRYPTDEV}\"\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"basename"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" $ROOTDEV)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"/sbin/cryptsetup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" luksOpen"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ${LUKSDEV} $CRYPTDEV "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"/dev/systty"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" 2"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[ "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":" =="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$ROOTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" ] &"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"amp"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"; ROOTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"/dev/mapper/${"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"CRYPTDEV"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"}\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Notice how a simple if conditional can be cropped right down. There is only a need to use the full clause if there are a number commands of or a single complex command to run on validation of the conditional. This is only an example, of course, and your system may well not use this exact version, but if you apply this kind of logic right through the file, you'll end up with a very compact InitRD."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It may sort of go without saying, but once you've finalised your InitRD and added it to your LILO configuration, reboot and check that it works."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This section of the guide may appear quite small and self explanatory, but it may well take you a lot of trial and error before you've got a usable system."}]},{"type":"element","tag":"h1","props":{"id":"see-you-tomorrow"},"children":[{"type":"text","value":"See you tomorrow!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm going to call it a night at this point in the guide and post the last section of it tomorrow where we'll look at hacking your rc scripts into tiny little pieces."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"n00b"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:2009-02-21-optimising-slackware-boot-time-part-2.md","_source":"content","_file":"posts/2009-02-21-optimising-slackware-boot-time-part-2.md","_stem":"posts/2009-02-21-optimising-slackware-boot-time-part-2","_extension":"md"}