{"_path":"/posts/mount-partitions-virtualbox-vdi-linux","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Mount partitions from a VirtualBox VDI in Linux.","description":"Mount your Virtualbox rig's partitions on the host machine","imagesource":null,"imagecredit":null,"image":"2011.07.07T140000_mount-partitions-virtualbox-vdi-linux.jpg","createdAt":"2011-07-07T14:00:00","updatedAt":"2011-07-07T14:00:00","readingTime":{"text":"1 min read","minutes":0.145,"time":8700,"words":29},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hi, people!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The title's pretty self explanatory, so I'll just dive right in..."}]},{"type":"element","tag":"h2","props":{"style":"color: red","id":"update-31-jul-12"},"children":[{"type":"text","value":"Update: 31-Jul-12"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"qemu-nbd is somewhat broken in Ubuntu Precise at the moment. Here's a new method (note: You will need quite a large amount of free HDD space to do this, as we make 2 separate copies of the original VDI). I've also written a "},{"type":"element","tag":"a","props":{"href":"https://gist.github.com/3218617","target":"_blank"},"children":[{"type":"text","value":"script, which should do the whole process for you"}]},{"type":"text","value":" (although you'll still need to install qemu-utils yourself)."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"sudo apt-get install qemu-utils\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" apt-get"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" qemu-utils\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You need qemu-utils for the command qemu-img. This command is for *buntu. Use your distribution's package manager to install the package."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"sudo apt-get install qemu-utils\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" apt-get"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" qemu-utils\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will show you a list of all your VM VDIs. Note down the UUID for the VDI you want to mount."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"VBoxManage clonehd UUIDGOESHERE outputfilename.vmdk --format=VMDK\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"VBoxManage"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" clonehd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" UUIDGOESHERE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" outputfilename.vmdk"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" --format=VMDK\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This command converts the VDI to a VMDK using VirtualBox's CLI."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"qemu-img convert -f vmdk inputfilename.vmdk -O raw outputfilename.raw\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"qemu-img"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" convert"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -f"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" vmdk"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" inputfilename.vmdk"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -O"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" raw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" outputfilename.raw\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here, we convert the HDD into a format readable by a generic Linux distribution."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"parted rawfilename.raw unit b print\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"parted"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" rawfilename.raw"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" unit"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" b"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" print\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, we list the partitions available in the raw disk image, to see their offsets. Note down the offset (remove the letter B from the end) of the partition you want to mount."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"sudo losetup -f\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" losetup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -f\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will tell you the next free loopback device. It will be in the format /dev/loop[n], where [n] is a number. On my machine, it's /dev/loop0, so I'll use that in the next example."}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"sudo losetup -o OFFSETGOESHERE /dev/loop0 rawfilename.raw\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" losetup"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -o"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" OFFSETGOESHERE"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" /dev/loop0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" rawfilename.raw\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Connect a loopback device to the file at the offset we noted down before."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now you can mount the loopback device (/dev/loop0 in my case) wherever you like."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Any questions, just ask!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"n00b"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"update-31-jul-12","depth":2,"text":"Update: 31-Jul-12"}]}},"_type":"markdown","_id":"content:posts:2011-07-07-mount-partitions-virtualbox-vdi-linux.md","_source":"content","_file":"posts/2011-07-07-mount-partitions-virtualbox-vdi-linux.md","_stem":"posts/2011-07-07-mount-partitions-virtualbox-vdi-linux","_extension":"md"}