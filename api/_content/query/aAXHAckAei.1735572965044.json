{"_path":"/posts/how-hot-plug-sata-drive-linux","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"How To Hot Plug a SATA drive in Linux","description":"How to hotplug SATA drives in Linux.","imagesource":null,"imagecredit":null,"imageFilename":"2013.01.22T150000_how-hot-plug-sata-drive-linux.png","createdAt":"2013-01-22T15:00:00","updatedAt":"2013-01-22T15:00:00","readingTime":{"text":"1 min read","minutes":0.04,"time":2400,"words":8},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hi guys,"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I knew SATA drives were hot-swappable, and a feature of a script I was writing required that the user be able to swap the drive that was plugged in at a certain point. It became obvious after checking the usual suspects (/var/log/messages, /var/log/dmesg) that the drive was not going to be detected by simply plugging it in. After a quick search online, I came up with "},{"type":"element","tag":"a","props":{"href":"http://fredericiana.com/2010/06/15/hot-plugging-a-sata-drive-under-linux/","target":"_blank"},"children":[{"type":"text","value":"fredericiana"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The reason appears to be that the OS needs a poke to tell it to rescan the device. In Linux, this is as simple as echoing a value to a file. Here goes:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"echo \"0 0 0\" &gt;/sys/class/scsi_host/host[n]/scan\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \"0 0 0\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" &"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":";"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"/sys/class/scsi_host/host[n]/scan\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"[n] will be one of a few numbers. Look in /sys/class/scsi_host to see what's available. There is one of these for each SATA port (this possibly includes PATA/IDE ports on newer kernels)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To remove a drive, use the following:"}]},{"type":"element","tag":"pre","props":{"className":"language-bash shiki shiki-themes github-dark","code":"echo \"x\" &gt; /sys/bus/scsi/devices/[n]:0:0:0/delete\n","language":"bash","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"echo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" \"x\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" &"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"gt"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"/sys/bus/scsi/devices/[n]:0:0:0/delete\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'll repeat the original author's warning, just so there's no confusion generated:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"\"Also, just to state the obvious, don't do that to a mounted drive, ever. Especially not the one that holds your system partition ;)\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"n00b"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:2013-01-22-how-hot-plug-sata-drive-linux.md","_source":"content","_file":"posts/2013-01-22-how-hot-plug-sata-drive-linux.md","_stem":"posts/2013-01-22-how-hot-plug-sata-drive-linux","_extension":"md"}