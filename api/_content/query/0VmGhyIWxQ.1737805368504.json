{"_path":"/posts/puppetlabs-puppet-mysql-mariadb-centos","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"Official Puppet Mysql & MariaDB on CentOS","description":"Making the puppetlabs-mysql official Puppet module work with the official MariaDB CentOS repositories.","imagesource":"https://www.flickr.com/photos/eschipul/5047874345/","imagecredit":"Ed Schipul","imageFilename":"2015.07.12T060000_puppetlabs-puppet-mysql-mariadb-centos.png","createdAt":"2015-07-12T06:00:00","updatedAt":"2015-07-12T06:00:00","readingTime":{"text":"1 min read","minutes":0.255,"time":15300,"words":51},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hi all,"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Today, I'm going to cover making the official puppetlabs-mysql usable with the MariaDB official repositories on CentOS. For some completely incomprehensible reason, the official MariaDB RPMs for CentOS6 don’t create the MariaDB folder in /var/run, meaning that we have to crack out a little hack to make the puppetlabs-mysql Puppet module work as it's intended."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The process will cover the following steps:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Manage the MariaDB package ourselves"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Manually create the MariaDB rundir"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Ensure proper ownership of the rundir"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'll assume you've already added the MariaDB repository to your copy of CentOS. If not, the "},{"type":"element","tag":"a","props":{"href":"https://downloads.mariadb.org/mariadb/repositories/","target":"_blank"},"children":[{"type":"text","value":"excellent guides on the MariaDB website"}]},{"type":"text","value":" should be enough to get you started. I'm going to put the code directly into a node classification, but you can do it pretty much anywhere you like. If you need to use this code more than once, consider putting it in a definition or class of its own."}]},{"type":"element","tag":"pre","props":{"className":"language-puppet shiki shiki-themes github-dark","code":"node 'puppet-mariadb.alexshepherd.me' {\n    $mariadb_package_name = ‘MariaDB-Server’\n    $mariadb_service_name = ‘mysql’\n\n    package { \"mysql-server\":\n        ensure =&gt; installed,\n        name =&gt; $mariadb_package_name\n    } -&gt;\n    file { 'mysql_rundir':\n        path =&gt; '/var/run/mysqld',\n        ensure =&gt; directory,\n        owner =&gt; 'mysql',\n        group =&gt; 'mysql'\n    } -&gt;\n    class { '::mysql::server':\n        package_manage =&gt; false,\n        package_name =&gt; $mariadb_package_name,\n        service_name =&gt; $mariadb_service_name\n    }\n}\n","language":"puppet","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"node"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" 'puppet-mariadb.alexshepherd.me'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    $mariadb_package_name = ‘"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"MariaDB"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"Server"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"’\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    $mariadb_service_name = ‘mysql’\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    package"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"mysql-server\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        ensure =&gt; installed,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        name =&gt; $mariadb_package_name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    } -&gt;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'mysql_rundir'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        path =&gt; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'/var/run/mysqld'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        ensure =&gt; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"directory"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        owner =&gt; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'mysql'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        group =&gt; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'mysql'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    } -&gt;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    class"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" { "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"'::mysql::server'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        package_manage =&gt; "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        package_name =&gt; $mariadb_package_name,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"        service_name =&gt; $mariadb_service_name\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is important that we use this exact dependency sequence, and these exact options in order to make it work. Particularly, the puppetlabs-mysql module depends on a package called "},{"type":"element","tag":"i","props":{},"children":[{"type":"text","value":"mysql-server"}]},{"type":"text","value":", so we alias it using the "},{"type":"element","tag":"i","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":" attribute on the package resource We also need to include package_name on ::mysql::server, as there are internal dependencies that cause issues if we don't set it, even though we choose specifically not to manage the package with the module."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Puppet, while an amazing tool that solves so many issues, does still feel a little hackish in places, but we wouldn't be managing servers if we minded performing the odd messy hack where appropriate! That's all for today - expect more devops-related posts moving forwards."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:posts:2015-07-12-puppetlabs-puppet-mysql-mariadb-centos.md","_source":"content","_file":"posts/2015-07-12-puppetlabs-puppet-mysql-mariadb-centos.md","_stem":"posts/2015-07-12-puppetlabs-puppet-mysql-mariadb-centos","_extension":"md"}