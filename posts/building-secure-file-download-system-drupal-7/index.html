<!DOCTYPE html><html  lang="en" data-capo=""><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Building a secure file download system for Drupal 7 | alexshepherd.me</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com">
<script src="/plugins/jquery-3.3.1.min.js"></script>
<script src="/plugins/moment.min.js"></script>
<script src="/plugins/livestamp.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&family=Rubik:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,300&family=Work+Sans:wght@200&family=Outfit:wght@200&family=Pontano+Sans:wght@300&family=Inconsolata:wght@500&display=swap">
<style>*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-size:1em;font-variation-settings:normal}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-feature-settings:inherit;font-size:100%;font-variation-settings:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]:where(:not([hidden=until-found])){display:none}:root{--accent1-rgb:238,95,56}body{font-size:16px;font-weight:400;--tw-text-opacity:1;color:rgb(99 99 99/var(--tw-text-opacity,1))}h1{font-size:40px}h1,h2{font-weight:700}h2{font-size:24px}@media (min-width:1024px){h2{font-size:36px}}@media (min-width:768px) and (max-width:1023px){h2{font-size:28px}}h3{font-size:32px;font-weight:700}@media (max-width:767px){h3{font-size:20px}}@media (min-width:768px) and (max-width:1023px){h3{font-size:24px}}h4{font-size:20px;font-weight:700}@media (min-width:1024px){h4{font-size:24px}}h5{font-size:18px;font-weight:700}@media (min-width:1024px){h5{font-size:22px}}h6{font-size:16px;font-weight:700}@media (min-width:1024px){h6{font-size:18px}}a{--tw-text-opacity:1;color:rgb(0 2 72/var(--tw-text-opacity,1));transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}a:hover{text-decoration-line:underline}button{transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.container{max-width:100%;padding:0 15px;width:100%}@media (max-width:1023px){.container{max-width:750x}}@media (min-width:1024px){.container{max-width:992px}}@media (min-width:1200px){.container{max-width:1200px}}.visible{visibility:visible}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.bottom-0{bottom:0}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-10{z-index:10}.order-first{order:-9999}.float-right{float:right}.mx-auto{margin-left:auto;margin-right:auto}.my-0{margin-bottom:0;margin-top:0}.my-2{margin-top:.5rem}.mb-2,.my-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mt-14{margin-top:3.5rem}.mt-2{margin-top:.5rem}.mt-\[5px\]{margin-top:5px}.block{display:block}.inline{display:inline}.flex{display:flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.size-3{height:.75rem;width:.75rem}.h-7{height:1.75rem}.h-full{height:100%}.w-7{width:1.75rem}.w-full{width:100%}.max-w-\[150px\]{max-width:150px}.max-w-\[180px\]{max-width:180px}.max-w-\[210px\]{max-width:210px}.max-w-\[405px\]{max-width:405px}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.justify-around{justify-content:space-around}.gap-2{gap:.5rem}.gap-\[30px\]{gap:30px}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.rounded-full{border-radius:9999px}.rounded-md{border-radius:.375rem}.border{border-width:1px}.border-t{border-top-width:1px}.border-\[\#bbb\]{--tw-border-opacity:1;border-color:rgb(187 187 187/var(--tw-border-opacity,1))}.border-zinc-50{--tw-border-opacity:1;border-color:rgb(250 250 250/var(--tw-border-opacity,1))}.bg-\[\#28C840\]{--tw-bg-opacity:1;background-color:rgb(40 200 64/var(--tw-bg-opacity,1))}.bg-\[\#F5F5F5\]{--tw-bg-opacity:1;background-color:rgb(245 245 245/var(--tw-bg-opacity,1))}.bg-\[\#FE5F57\]{--tw-bg-opacity:1;background-color:rgb(254 95 87/var(--tw-bg-opacity,1))}.bg-\[\#FEBC2E\]{--tw-bg-opacity:1;background-color:rgb(254 188 46/var(--tw-bg-opacity,1))}.bg-accent1{--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1))}.bg-code_background{--tw-bg-opacity:1;background-color:rgb(21 23 24/var(--tw-bg-opacity,1))}.bg-neutral-400{--tw-bg-opacity:1;background-color:rgb(163 163 163/var(--tw-bg-opacity,1))}.bg-transparent{background-color:transparent}.bg-cover{background-size:cover}.bg-center{background-position:50%}.bg-no-repeat{background-repeat:no-repeat}.stroke-white{stroke:#fff}.p-1{padding:.25rem}.p-\[30px\]{padding:30px}.px-3{padding-left:.75rem;padding-right:.75rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-7{padding-left:1.75rem;padding-right:1.75rem}.py-3{padding-bottom:.75rem;padding-top:.75rem}.py-4{padding-bottom:1rem;padding-top:1rem}.py-5{padding-bottom:1.25rem;padding-top:1.25rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.pb-5{padding-bottom:1.25rem}.pb-6{padding-bottom:1.5rem}.pb-\[70px\]{padding-bottom:70px}.pt-2{padding-top:.5rem}.pt-3{padding-top:.75rem}.pt-7{padding-top:1.75rem}.pt-\[40px\]{padding-top:40px}.text-center{text-align:center}.font-heebo{font-family:Heebo,ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-pontano{font-family:Pontano Sans,ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-\[15px\]{font-size:15px}.text-\[17px\]{font-size:17px}.text-\[25px\]{font-size:25px}.text-\[40px\]{font-size:40px}.text-xs{font-size:.75rem;line-height:1rem}.font-\[500\]{font-weight:500}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.uppercase{text-transform:uppercase}.leading-7{line-height:1.75rem}.leading-\[1\]{line-height:1}.leading-normal{line-height:1.5}.text-heading{--tw-text-opacity:1;color:rgb(0 2 72/var(--tw-text-opacity,1))}.text-paragraph{--tw-text-opacity:1;color:rgb(99 99 99/var(--tw-text-opacity,1))}.text-primary{--tw-text-opacity:1;color:rgb(51 51 51/var(--tw-text-opacity,1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.text-zinc-400{--tw-text-opacity:1;color:rgb(161 161 170/var(--tw-text-opacity,1))}.text-zinc-50{--tw-text-opacity:1;color:rgb(250 250 250/var(--tw-text-opacity,1))}.text-zinc-600{--tw-text-opacity:1;color:rgb(82 82 91/var(--tw-text-opacity,1))}.opacity-50{opacity:.5}.opacity-\[0\.15\]{opacity:.15}.shadow-\[0_0_50px_0_rgba\(196\2c 206\2c 213\2c 0\.2\)\]{--tw-shadow:0 0 50px 0 rgba(196,206,213,.2);--tw-shadow-colored:0 0 50px 0 var(--tw-shadow-color)}.shadow-\[0_0_50px_0_rgba\(196\2c 206\2c 213\2c 0\.2\)\],.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.outline{outline-style:solid}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.duration-500{transition-duration:.5s}.title-stroke{text-shadow:3px 3px 0 #ee5f38,-1px -1px 0 #ee5f38,1px -1px 0 #ee5f38,-1px 1px 0 #ee5f38,1px 1px 0 #ee5f38}#preloader{display:flex;height:100vh;left:0;position:fixed;top:0;width:100%;z-index:999}#preloader:before{left:0}#preloader:after,#preloader:before{height:100%;position:absolute;top:0;width:50%;z-index:-1;--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity,1));transition-duration:.3s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);--tw-content:"";content:var(--tw-content)}#preloader:after{left:auto;right:0}.preloaded:after,.preloaded:before{animation:preloadedDone .3s ease-in-out .5s forwards}.loader--border{height:250px;margin:auto;overflow:hidden;position:relative;transition-duration:.7s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);width:1px}.loader--border:before{height:0;top:50%;--tw-translate-y:-50%;--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1));--tw-content:""}.loader--border:after,.loader--border:before{content:var(--tw-content);left:0;position:absolute;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));width:1px}.loader--border:after{height:100%;top:0;--tw-translate-y:-100%;--tw-bg-opacity:1;background-color:rgb(153 153 153/var(--tw-bg-opacity,1));--tw-content:""}.loader--border:before{animation:borderLine 1s ease-in-out 0s forwards}.loader--border:after{animation:borderRound 1.2s linear 0s infinite;animation-delay:2s}.preloaded .loader--border{height:100%!important;opacity:0}.preloaded .loader--border:after{opacity:0}@keyframes borderLine{0%{height:0}to{height:100%}}@keyframes borderRound{0%{transform:translateY(-100%)}to{transform:translateY(200%)}}@keyframes preloadedDone{0%{width:50%}to{width:0}}.header__sticky.sticky{left:0;position:fixed;top:0;width:100%;z-index:98;--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1));padding-left:.25rem;padding-right:.25rem;--tw-shadow:0 0 10px 0 rgba(0,0,0,.1);--tw-shadow-colored:0 0 10px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.header__sticky.sticky:is(.dark *){--tw-bg-opacity:1;background-color:rgb(24 26 29/var(--tw-bg-opacity,1))}section{scroll-margin-top:100px}.btn{border-radius:50px;font-size:24px;font-weight:500;padding:10px 42px;transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}@media (max-width:767px){.btn{font-size:18px;padding:8px 28px}}@media (min-width:768px) and (max-width:1023px){.btn{font-size:20px;padding-left:32px;padding-right:32px}}.btn--small{border-radius:50px;font-size:17px;font-weight:500;padding:10px 25px;transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.outline-btn{border-width:1px;--tw-border-opacity:1;border-color:rgb(11 60 93/var(--tw-border-opacity,1))}.outline-btn:hover,.solid-btn{--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1));--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.solid-btn:hover{--tw-bg-opacity:1;background-color:rgb(51 51 51/var(--tw-bg-opacity,1))}.solid-btn:hover:is(.dark *){--tw-bg-opacity:1;background-color:rgb(24 26 29/var(--tw-bg-opacity,1))}.link-button{display:inline-block;font-size:17px;font-weight:500;line-height:28px;position:relative;text-transform:capitalize;transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.link-button:before{height:7px;position:absolute;top:50%;width:7px;--tw-translate-y:-50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-content:"";content:var(--tw-content)}.link-button:where([dir=ltr],[dir=ltr] *){padding-left:18px}.link-button:where([dir=ltr],[dir=ltr] *):before{content:var(--tw-content);left:0}.link-button:where([dir=rtl],[dir=rtl] *){padding-right:18px}.link-button:where([dir=rtl],[dir=rtl] *):before{content:var(--tw-content);right:0}.service-shape{position:relative}.service-shape:before{bottom:70%;height:115px;left:50%;position:absolute;width:72%;z-index:-1;--tw-translate-x:-50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-content:"";content:var(--tw-content)}.client__logo--padding{padding-left:30px;padding-right:30px}@media (min-width:1024px){.client__logo--padding{padding-left:55px;padding-right:55px}}@media (max-width:600px){.client__logo--padding{padding-left:0;padding-right:0}}@media (min-width:768px) and (max-width:1023px){.client__logo--padding{padding-left:45px;padding-right:45px}}.client__logo--padding--inner{padding-bottom:40px;padding-top:40px}@media (max-width:600px){.client__logo--padding--inner{align-items:center;display:flex;min-height:130px;padding-left:25px;padding-right:25px}}button.is-checked{--tw-text-opacity:1;color:rgb(11 60 93/var(--tw-text-opacity,1))}button.is-checked:is(.dark *){--tw-text-opacity:1;color:rgb(11 60 93/var(--tw-text-opacity,1))}.hero__layer--img.four{animation-duration:3s;animation-iteration-count:infinite;animation-name:animateUpDown;animation-timing-function:cubic-bezier(.54,.085,.5,.92);left:37.5rem;top:36%;transition:all .4s cubic-bezier(.645,.045,.355,1)}@keyframes animateUpDown{0%{transform:translateY(0)}50%{transform:translateY(-20px);-webkit-transform:translateY(-20px);-moz-transform:translateY(-20px);-ms-transform:translateY(-20px);-o-transform:translateY(-20px)}to{transform:translateY(0)}}.animateUpDown{animation-duration:4s;animation-iteration-count:infinite;animation-name:animateUpDown;animation-timing-function:cubic-bezier(.54,.085,.5,.92);transition:all .4s cubic-bezier(.645,.045,.355,1)}.offcanvas__close--btn:is(.dark *):after,.offcanvas__close--btn:is(.dark *):before,.offcanvas__sub_menu_toggle:is(.dark *):after,.offcanvas__sub_menu_toggle:is(.dark *):before{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.portfolio__parent:hover .portfolio__overlay{opacity:.7}.portfolio__parent:hover .portfolio--sub-title,.portfolio__parent:hover .portfolio--title{--tw-translate-y:0px}.portfolio__parent:hover .portfolio--sub-title,.portfolio__parent:hover .portfolio--title,.portfolio__parent:hover .portfolio--zoom{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.portfolio__parent:hover .portfolio--zoom{--tw-translate-y:-7px}.modal_portfolio.active{opacity:1;visibility:visible}.active .modal__portfolio--content{--tw-translate-y:0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active+.modal_popup_overlay{opacity:.3;visibility:visible}.swiper-pagination{position:inherit}.swiper-pagination-bullet{border-radius:.375rem;height:10px;width:2rem;--tw-bg-opacity:1;background-color:rgb(235 235 235/var(--tw-bg-opacity,1));opacity:1;transition-duration:.3s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.swiper-pagination-bullet-active{width:2.5rem;--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1))}.blog__card:hover .blog__thumb{--tw-scale-x:1.02;--tw-scale-y:1.02;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}#light__to--dark .light--mode__icon,#light__to--dark.dark--version .dark--mode__icon{display:none}#light__to--dark.dark--version .light--mode__icon{display:block}.menu__nav--item:hover>span:last-child{opacity:1;visibility:visible}.menu__nav--item:hover>span:last-child:where([dir=ltr],[dir=ltr] *){right:1.25rem}.menu__nav--item:hover>span:last-child:where([dir=rtl],[dir=rtl] *){left:1.25rem}.menu__nav--item:hover{--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1))}.menu__nav--item:hover svg,.mobile--menu__nav--item:hover svg{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.mobile--menu__nav--item:hover{--tw-bg-opacity:1;background-color:rgb(51 51 51/var(--tw-bg-opacity,1))}.toggle__navigation--button span{transition:background-color .2s}.menu--visible .toggle__navigation--button{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.menu--visible .toggle__navigation--button span,.menu--visible .toggle__navigation--button span:after,.menu--visible .toggle__navigation--button span:before{--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1))}.toggle__navigation--button span:after,.toggle__navigation--button span:before{backface-visibility:hidden;transition:transform .2s}.menu--visible .toggle__navigation--button span{background-color:transparent}.menu--visible .toggle__navigation--button span:before{transform:rotate(-45deg)}.menu--visible .toggle__navigation--button span:after{transform:rotate(45deg)}.toggle__nav--menu{transition:visibility .3s}.toggle__navigation.menu--visible .toggle__nav--menu{visibility:visible}.toggle__navigation .toggle__nav--menu--bg{box-shadow:0 1px 4px rgba(0,0,0,.2);transition:height .2s,box-shadow .2s}.toggle__navigation.menu--visible .toggle__nav--menu--bg{box-shadow:0 6px 30px rgba(0,0,0,.2);height:100%}.toggle__nav--menu--label-wrapper{transition:color .2s}.toggle__nav--menu--label-wrapper:where([dir=ltr],[dir=ltr] *){padding-left:calc(1rem + 20px)}.toggle__nav--menu--label-wrapper:where([dir=rtl],[dir=rtl] *){padding-right:calc(1rem + 20px)}.toggle__navigation ul li .toggle__nav--menu--label-wrapper:hover,.toggle__navigation ul li.active .toggle__nav--menu--label-wrapper{--tw-text-opacity:1;color:rgb(11 60 93/var(--tw-text-opacity,1))}.toggle__nav--menu--label-wrapper:before{transform:translateX(3px) translateY(-50%) scaleY(0)}.toggle__navigation ul li .toggle__nav--menu--label-wrapper:before{--tw-bg-opacity:1;background-color:rgb(11 60 93/var(--tw-bg-opacity,1))}.toggle__navigation.menu--visible ul li.active .toggle__nav--menu--label-wrapper:before{transform:translateX(-3px) translateY(-50%) scaleY(1);transition:transform .15s .3s}.toggle__nav--menu--label{transform:translateX(-25px)}.toggle__navigation.menu--visible ul .toggle__nav--menu--label{animation:slideInLeft .15s backwards;opacity:1;transform:translateX(0);transition:transform .2s}.toggle__navigation.menu--visible ul li:first-of-type .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:first-of-type .toggle__nav--menu--label-wrapper:after{animation-delay:.05s}.toggle__navigation.menu--visible ul li:nth-of-type(2) .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:nth-of-type(2) .toggle__nav--menu--label-wrapper:after{animation-delay:.1s}.toggle__navigation.menu--visible ul li:nth-of-type(3) .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:nth-of-type(3) .toggle__nav--menu--label-wrapper:after{animation-delay:.15s}.toggle__navigation.menu--visible ul li:nth-of-type(4) .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:nth-of-type(4) .toggle__nav--menu--label-wrapper:after{animation-delay:.2s}.toggle__navigation.menu--visible ul li:nth-of-type(5) .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:nth-of-type(5) .toggle__nav--menu--label-wrapper:after{animation-delay:.25s}.toggle__navigation.menu--visible ul li:nth-of-type(6) .toggle__nav--menu--label,.toggle__navigation.menu--visible ul li:nth-of-type(6) .toggle__nav--menu--label-wrapper:after{animation-delay:.28s}@keyframes slideInLeft{0%{opacity:0;transform:translateX(-25px)}to{opacity:1;transform:translateX(0)}}.toggle__navigation.menu--visible{pointer-events:auto}.toggle__nav--menu-icon{transition:transform .2s}.toggle__navigation.menu--visible ul .toggle__nav--menu-icon{opacity:1}.toggle__nav--menu-icon>svg{width:1.1rem}#scroll__top.active{visibility:visible;--tw-translate-y:0px;opacity:1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.offcanvas__sub_menu_toggle:where([dir=ltr],[dir=ltr] *){right:0}.offcanvas__sub_menu_toggle:where([dir=rtl],[dir=rtl] *){left:0}.offcanvas__sub_menu_item{padding-bottom:15px;padding-top:15px}.offcanvas__sub_menu_item:where([dir=ltr],[dir=ltr] *){padding-left:30px}.offcanvas__sub_menu_item:where([dir=rtl],[dir=rtl] *){padding-right:30px}article.blog-post p{padding-bottom:.5rem;padding-top:.5rem}article.blog-post ul{list-style-type:disc;padding-left:1.5rem}article.blog-post ol{list-style-type:decimal;padding-left:1.5rem}article.blog-post h2{padding-bottom:.25rem;padding-top:1rem}article.blog-post h3,article.blog-post h4{padding-bottom:.125rem;padding-top:.75rem}article.blog-post h5,article.blog-post h6{padding-top:.5rem}article.blog-post code{color:#fff}article.blog-post :not(pre)>code{font-family:Inconsolata,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;padding-left:.25rem;padding-right:.25rem;--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.hover\:text-accent1:hover{--tw-text-opacity:1;color:rgb(11 60 93/var(--tw-text-opacity,1))}.hover\:no-underline:hover{text-decoration-line:none}.hover\:shadow-\[0_0_100px_0_rgba\(196\2c 206\2c 213\2c 0\.7\)\]:hover{--tw-shadow:0 0 100px 0 rgba(196,206,213,.7);--tw-shadow-colored:0 0 100px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.group:hover .group-hover\:block{display:block}.group:hover .group-hover\:hidden{display:none}.dark\:bg-gray-600:is(.dark *){--tw-bg-opacity:1;background-color:rgb(75 85 99/var(--tw-bg-opacity,1))}.dark\:text-white\/60:is(.dark *){color:hsla(0,0%,100%,.6)}@media (max-width:767px){.sm\:grid{display:grid}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.sm\:pt-5{padding-top:1.25rem}.sm\:pt-\[20px\]{padding-top:20px}}@media (max-width:1023px){.md\:block{display:block}.md\:hidden{display:none}.md\:px-\[15px\]{padding-left:15px;padding-right:15px}}@media (min-width:1024px){.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.lg\:items-center{align-items:center}.lg\:px-\[15px\]{padding-left:15px;padding-right:15px}.lg\:pb-\[100px\]{padding-bottom:100px}.lg\:pl-\[230px\]{padding-left:230px}.lg\:pl-\[30px\]{padding-left:30px}.lg\:pr-\[30px\]{padding-right:30px}.lg\:pt-4{padding-top:1rem}.lg\:pt-\[50px\]{padding-top:50px}.lg\:text-\[40px\]{font-size:40px}.lg\:text-\[70px\]{font-size:70px}}@media (min-width:1200px){.xl\:px-\[30px\]{padding-left:30px;padding-right:30px}.xl\:pl-\[300px\]{padding-left:300px}.xl\:pl-\[50px\]{padding-left:50px}.xl\:pr-\[50px\]{padding-right:50px}.xl\:pt-8{padding-top:2rem}.xl\:pt-\[70px\]{padding-top:70px}}@media (min-width:768px) and (max-width:1023px){.only-md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.only-md\:pl-5{padding-left:1.25rem}.only-md\:pr-\[20px\]{padding-right:20px}.only-md\:text-\[35px\]{font-size:35px}.only-md\:text-\[55px\]{font-size:55px}}</style>
<style>.offcanvas__header--menu__open{display:none;line-height:1}.offcanvas__header--menu__open--btn>*{pointer-events:none}@media only screen and (max-width:991px){.offcanvas__header--menu__open{display:block}}.offcanvas__header--menu__open--svg{width:32px}.offcanvas__header{box-shadow:0 0 10px rgba(0,0,0,.15);height:100vh;left:0;max-width:300px;opacity:0;position:fixed;top:0;transform:translateX(-100%);transition:.3s;visibility:hidden;width:100%;z-index:9999}@media only screen and (min-width:480px){.offcanvas__header{max-width:320px}}.offcanvas__header.open{opacity:1;transform:translateX(0);visibility:visible}.offcanvas__header.open~.offcanvas-overlay{opacity:.75;visibility:visible}.offcanvas-overlay{background-color:#000;height:100%;left:0;opacity:0;position:fixed;top:0;transition:.3s;visibility:hidden;width:100%;z-index:9998}.offcanvas__inner{height:100%;position:relative}.offcanvas__logo{align-items:center;display:flex;justify-content:space-between;padding:20px 15px}.offcanvas__close--btn{align-self:center;background-color:transparent;border:none;height:20px;padding:0;position:relative;text-indent:-9999px;width:20px}.offcanvas__close--btn:after,.offcanvas__close--btn:before{background-color:#000;content:"";height:2px;left:0;margin-top:-1px;position:absolute;top:50%;transform:rotate(45deg);width:100%}.offcanvas__close--btn:after{transform:rotate(-45deg)}.offcanvas__menu{height:100%;overflow-y:auto}.offcanvas__menu_ul{list-style:none;margin:0;max-height:300px;overflow:auto;padding:0}.offcanvas__menu_li{border-bottom:1px solid #e4e4e4;position:relative}.offcanvas__menu_li:first-child{border-top:1px solid #e4e4e4}.offcanvas__menu_item{display:block;line-height:1;padding:15px 20px;text-transform:uppercase}.offcanvas__sub_menu{display:none;list-style:none;margin:0;padding:0}.offcanvas__sub_menu_li{border-top:1px solid #e4e4e4;position:relative}.offcanvas__sub_menu_item{display:block;line-height:1}.offcanvas__sub_menu_item~.offcanvas__sub_menu .offcanvas__sub_menu_item{padding-left:40px}.offcanvas__sub_menu_toggle{background-color:transparent;border:none;border-radius:0;font-size:20px;height:46px;padding:0;position:absolute;top:0;width:40px;z-index:9}.offcanvas__sub_menu_toggle:after,.offcanvas__sub_menu_toggle:before{background-color:#000;content:"";height:2px;left:50%;position:absolute;top:50%;transform:translateX(-50%) translateY(-50%);transition:.3s;width:12px}.offcanvas__sub_menu_toggle:not(.active):after{transform:translateX(-50%) translateY(-50%) rotate(90deg)}.offcanvas__account--items{padding:28px 17px 20px}.offcanvas__account--items__icon{background:#ee2761;border-radius:50%;color:#fff;height:30px;line-height:28px;text-align:center;width:30px}</style>
<style>pre code .line{display:block}</style>
<script src="/js/imagesloaded.pkgd.min.js" defer></script>
<script src="/js/isotope.pkgd.min.js" defer></script>
<script src="/js/script.js" defer></script>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta property="og:url" content="http://localhost:3000/posts/building-secure-file-download-system-drupal-7">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Building a secure file download system for Drupal 7">
<meta name="twitter:description" content="Drupal authentication based secure file download php script.">
<meta name="twitter:image" content="http://localhost:3000/images/posts/2011.09.08T140000_building-secure-file-download-system-drupal-7.jpg">
<meta property="og:title" content="Building a secure file download system for Drupal 7">
<meta name="description" content="Drupal authentication based secure file download php script.">
<meta property="og:description" content="Drupal authentication based secure file download php script.">
<meta property="og:image" content="2011.09.08T140000_building-secure-file-download-system-drupal-7.jpg">
<script id="unhead:payload" type="application/json">{"title":"Dev Blog","titleTemplate":"%s | alexshepherd.me"}</script></head><body  class="bg-[#F5F5F5]"><div id="__nuxt"><div><!--[--><div class="md:hidden lg:flex lg:items-center bg-accent1 fixed left-0 top-0 h-full"><div><div class="logo flex justify-center items-center"><a href="/"><img class="max-w-[210px] px-5" src="/images/logo.svg" alt=""></a></div><div class="pt-[40px]"><div class="max-w-[405px] order-first"><div><div class="text-center z-10"><div class="pb-5"><img class="rounded-full mx-auto border border-zinc-50 p-1 max-w-[180px]" src="/images/profile.jpg" alt=""></div><span class="text-zinc-50 font-pontano"> Backend / DevOps / Architect</span></div><div class="text-center pt-3 pb-6 z-10"><span class="text-zinc-50 font-pontano">Brit by birth,<br>located worldwide</span></div><div class="border-t border-[#bbb] py-6 px-7 z-10"><div class="flex items-center justify-around"><a class="w-7 h-7 flex items-center" href="https://linkedin.com/in/n00bsys0p" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="#fafafa"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="w-7 h-7 flex items-center justify-center" href="https://github.com/n00bsys0p" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" fill="#fafafa"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></div></div></div></div><p class="text-slate-500 mt-14 text-xs text-center px-5"> All content © Alex Shepherd 2008-2024<br>unless otherwise noted</p></div></div><div class="offcanvas__header lg:hidden bg-accent1"><div class="offcanvas__inner"><div class="offcanvas__logo justify-end"><button class="offcanvas__close--btn text-white float-right" data-offcanvas>close</button></div><nav class="offcanvas__menu"><div><div class="logo flex justify-center items-center"><a href="/"><img class="max-w-[210px] px-5" src="/images/logo.svg" alt=""></a></div><div class="pt-[40px]"><div class="max-w-[405px] order-first"><div><div class="text-center z-10"><div class="pb-5"><img class="rounded-full mx-auto border border-zinc-50 p-1 max-w-[180px]" src="/images/profile.jpg" alt=""></div><span class="text-zinc-50 font-pontano">Full stack / DevOps / Architect</span></div><div class="text-center pt-2 pb-6 z-10"><span class="text-zinc-50 font-pontano">Brit by birth, located worldwide</span></div><div class="border-t border-[#bbb] py-6 px-7 z-10"><div class="flex items-center justify-around"><a class="w-7 h-7 flex items-center" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="#fafafa"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a class="w-7 h-7 flex items-center justify-center" href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" fill="#fafafa"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></div></div></div></div><p class="text-slate-500 mt-14 text-xs text-center px-5"> All content © Alex Shepherd 2008-2024<br>unless otherwise noted</p></div></nav></div></div><div class="h-full bg-[#F5F5F5] bg-cover bg-no-repeat bg-center"><header class="hidden w-full md:block xl:pt-8 pt-7 bg-accent1"><div class="xxl:px-[100px] xl:px-[30px] lg:px-[15px] md:px-[15px]"><div class="flex justify-center"><div class="logo hidden md:block"><a href="/"><img class="max-w-[150px]" src="/images/logo.svg" alt=""></a></div></div></div><div class="lg:hidden flex justify-center py-4"><button class="offcanvas__header--menu__open--btn text-zinc-50" data-offcanvas><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button></div></header><main><div class="xxl:pl-[440px] xl:pl-[300px] lg:pl-[230px] xxl:pr-[100px] xl:pr-[50px] lg:pr-[30px] only-md:pr-[20px] md:px-[15px]"><div class="xxl:pl-[100px] xl:pl-[50px] lg:pl-[30px] only-md:pl-5"><section class="blog-list px-3 py-5 p-md-5"><article class="blog-post px-3 py-5 p-md-5"><header class="blog-post-header"><h2 class="title mb-2 text-heading">Building a secure file download system for Drupal 7</h2><div class="mb-3"><span class="text-zinc-600">Published <span data-livestamp="2011-09-08T14:00:00"></span></span><br><small class="text-zinc-400">3 min read</small></div></header><div class="blog-post-body"><figure class="blog-banner"><img class="img-fluid" src="/images/posts/2011.09.08T140000_building-secure-file-download-system-drupal-7.jpg" alt="image"><figcaption class="mt-2 text-center image-caption"> Image Credit: <span>Unknown (if this is your work, reach out to me and I&#39;ll credit you!)</span></figcaption></figure><!--[--><div><p><!--[-->Hi guys,<!--]--></p><p><!--[-->I thought I&#39;d extend what I&#39;d learnt through building the DokuDrupal authentication backend by writing a secure file download script for use with Drupal 7.<!--]--></p><p><!--[-->The brief I gave myself for the project was as follows:<!--]--></p><ul><!--[--><li><!--[-->
        Files should be held in a location inaccessible to the web server, to avoid hotlinking<!--]--></li><li><!--[-->
        The user must be authenticated with the Drupal instance held on the server in order to use the download script<!--]--></li><li><!--[-->
        No filenames must be visible from the URLs given.<!--]--></li><!--]--></ul><p><!--[-->The project was actually a lot simpler than I initially thought it was going to be. A lot of the authentication code could be copied almost directly from the <a href="http://n00bsys0p.co.uk/code/dokudrupal-auth-backend/listing.php?repname=Dokuwiki+Drupal+7+Authentication+Backend" rel="noopener noreferrer" target="_blank"><!--[-->Dokuwiki auth backend<!--]--></a>, as the basic method of checking authentication was just done in a PHP loop through all the users local cookies. I&#39;ll go through each of the functions I wrote individually, then show how they&#39;re used to confirm authentication.<!--]--></p><p><!--[--><a href="http://n00bsys0p.co.uk/stikked/index.php/view/46469766" rel="noopener noreferrer" target="_blank"><!--[-->Here&#39;s a link<!--]--></a> to the whole code without breaks in my Stikked pastebin.
        <!--]--></p><p><!--[-->The workhorse function for the script is &quot;checkAuth&quot;. It starts by finding a cookie which looks like a Drupal 7 session cookie. For any cookie it finds which matches the regex &#39;/^SESS[\w]{32}$/&#39;, it will proceed to try and find it in the Drupal sessions table. If it succeeds, it returns true. If, however, it loops through all user cookies, and none match the criteria, or are found in the database, it will return false.<!--]--></p><div language="php" meta style=""><div class="border shadow-lg bg-code_background my-2 rounded-md py-3 px-5 group overflow-x-auto"><div class="flex sm:grid sm:grid-cols-3 mb-3 justify-between items-center"><div class="flex gap-2"><div class="size-3 rounded-full bg-[#FE5F57] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#FEBC2E] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#28C840] hidden group-hover:block"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div></div><div class="font-mono text-xs text-center dark:text-white/60 max-sm:truncate"></div><div class="flex justify-end text-zinc-50"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy-icon cursor-pointer opacity-50"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></div></div><pre class="language-php shiki shiki-themes github-dark my-0 font-[500] bg-transparent leading-normal font-mono"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">/**
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D"> * ******************************************
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D"> * ** Drupal Secure Download Script **
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D"> * ******************************************
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D"> *  Author: Alex Shepherd &lt;n00batnospamn00bsys0p.co.uk&gt;
</span></span><span class="line" line="7"><span style="--shiki-default:#6A737D"> *  License: GPL2 (http://www.gnu.org/licenses/gpl-2.0.html)
</span></span><span class="line" line="8"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D"> **/
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#6A737D">/**
</span></span><span class="line" line="12"><span style="--shiki-default:#6A737D"> *  ***************
</span></span><span class="line" line="13"><span style="--shiki-default:#6A737D"> *  ** checkAuth **
</span></span><span class="line" line="14"><span style="--shiki-default:#6A737D"> *  ***************
</span></span><span class="line" line="15"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="16"><span style="--shiki-default:#6A737D"> *  Check whether the user is currently logged into
</span></span><span class="line" line="17"><span style="--shiki-default:#6A737D"> *  Drupal.
</span></span><span class="line" line="18"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="19"><span style="--shiki-default:#6A737D"> *  return  bool    True if user has cookies which match
</span></span><span class="line" line="20"><span style="--shiki-default:#6A737D"> *          the Drupal database.
</span></span><span class="line" line="21"><span style="--shiki-default:#6A737D"> **/
</span></span><span class="line" line="22"><span style="--shiki-default:#F97583">function</span><span style="--shiki-default:#B392F0"> checkAuth</span><span style="--shiki-default:#E1E4E8">() {
</span></span><span class="line" line="23"><span style="--shiki-default:#6A737D">  // Initialise function variables
</span></span><span class="line" line="24"><span style="--shiki-default:#E1E4E8">  $sessioncookie </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="25"><span style="--shiki-default:#E1E4E8">  $uid </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="26"><span style="--shiki-default:#E1E4E8">  $username </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="27"><span style="--shiki-default:#E1E4E8">  $cookies </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $_COOKIE;
</span></span><span class="line" line="28"><span emptylineplaceholder="true">
</span></span><span class="line" line="29"><span style="--shiki-default:#6A737D">  // Read in Drupal settings file
</span></span><span class="line" line="30"><span style="--shiki-default:#F97583">  include</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;../sites/default/settings.php&#39;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="31"><span style="--shiki-default:#E1E4E8">  $dbhost </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $databases[</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;host&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="32"><span style="--shiki-default:#E1E4E8">  $dbpass </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $databases[</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;password&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="33"><span style="--shiki-default:#E1E4E8">  $dbuser </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $databases[</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;username&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="34"><span style="--shiki-default:#E1E4E8">  $dbname </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $databases[</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;default&#39;</span><span style="--shiki-default:#E1E4E8">][</span><span style="--shiki-default:#9ECBFF">&#39;database&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="35"><span emptylineplaceholder="true">
</span></span><span class="line" line="36"><span style="--shiki-default:#6A737D">  // Main processing loop
</span></span><span class="line" line="37"><span style="--shiki-default:#F97583">  foreach</span><span style="--shiki-default:#E1E4E8">($cookies </span><span style="--shiki-default:#F97583">as</span><span style="--shiki-default:#E1E4E8"> $key</span><span style="--shiki-default:#F97583">=&amp;</span><span style="--shiki-default:#79B8FF">gt</span><span style="--shiki-default:#E1E4E8">;$val) {
</span></span><span class="line" line="38"><span style="--shiki-default:#6A737D">    // Ignore any cookie with anything but alphanumeric characters
</span></span><span class="line" line="39"><span style="--shiki-default:#F97583">    if</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#F97583">!</span><span style="--shiki-default:#79B8FF">preg_match</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;/</span><span style="--shiki-default:#F97583">^</span><span style="--shiki-default:#DBEDFF">[\w-]</span><span style="--shiki-default:#F97583">+$</span><span style="--shiki-default:#9ECBFF">/&#39;</span><span style="--shiki-default:#E1E4E8">, $key)
</span></span><span class="line" line="40"><span style="--shiki-default:#F97583">    ||</span><span style="--shiki-default:#F97583"> !</span><span style="--shiki-default:#79B8FF">preg_match</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;/</span><span style="--shiki-default:#F97583">^</span><span style="--shiki-default:#DBEDFF">[\w-]</span><span style="--shiki-default:#F97583">+$</span><span style="--shiki-default:#9ECBFF">/&#39;</span><span style="--shiki-default:#E1E4E8">, $val)) {
</span></span><span class="line" line="41"><span style="--shiki-default:#F97583">      continue</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="42"><span style="--shiki-default:#E1E4E8">    }
</span></span><span class="line" line="43"><span emptylineplaceholder="true">
</span></span><span class="line" line="44"><span style="--shiki-default:#6A737D">    // If we are using HTTPS, the first chars of the
</span></span><span class="line" line="45"><span style="--shiki-default:#6A737D">    // Drupal cookie are SSESS. Drupal&#39;s HTTP cookies
</span></span><span class="line" line="46"><span style="--shiki-default:#6A737D">    // start with SESS.
</span></span><span class="line" line="47"><span emptylineplaceholder="true">
</span></span><span class="line" line="48"><span style="--shiki-default:#6A737D">    // The commented line is the equivalent of the one below, which uses regex instead
</span></span><span class="line" line="49"><span style="--shiki-default:#6A737D">    //if(substr($key, 0, 4) == &#39;SESS&#39; &amp;amp;&amp;amp; strlen($key) == 36) {
</span></span><span class="line" line="50"><span style="--shiki-default:#F97583">    if</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#79B8FF">preg_match</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;/</span><span style="--shiki-default:#F97583">^</span><span style="--shiki-default:#DBEDFF">SESS[\w]{32}</span><span style="--shiki-default:#F97583">$</span><span style="--shiki-default:#9ECBFF">/&#39;</span><span style="--shiki-default:#E1E4E8">, $key)) {
</span></span><span class="line" line="51"><span style="--shiki-default:#E1E4E8">      $sessioncookie </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $val;
</span></span><span class="line" line="52"><span style="--shiki-default:#E1E4E8">    } </span><span style="--shiki-default:#F97583">else</span><span style="--shiki-default:#E1E4E8"> {
</span></span><span class="line" line="53"><span style="--shiki-default:#F97583">      continue</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="54"><span style="--shiki-default:#E1E4E8">    }
</span></span><span class="line" line="55"><span emptylineplaceholder="true">
</span></span><span class="line" line="56"><span style="--shiki-default:#6A737D">    // Now we have a cookie, find it in the database
</span></span><span class="line" line="57"><span style="--shiki-default:#79B8FF">    mysql_connect</span><span style="--shiki-default:#E1E4E8">($dbhost, $dbuser, $dbpass) </span><span style="--shiki-default:#F97583">or</span><span style="--shiki-default:#F97583"> die</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;Critical failure. Cannot connect to database.&#39;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="58"><span style="--shiki-default:#79B8FF">    mysql_select_db</span><span style="--shiki-default:#E1E4E8">($dbname) </span><span style="--shiki-default:#F97583">or</span><span style="--shiki-default:#F97583"> die</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;Critical failure. Cannot open database.&#39;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="59"><span emptylineplaceholder="true">
</span></span><span class="line" line="60"><span style="--shiki-default:#6A737D">    // Bear in mind that if using HTTPS, &quot;s.sid&quot; should be changed to &quot;s.ssid&quot;
</span></span><span class="line" line="61"><span style="--shiki-default:#E1E4E8">    $sql </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;</span><span style="--shiki-default:#F97583">SELECT</span><span style="--shiki-default:#79B8FF"> u</span><span style="--shiki-default:#9ECBFF">.</span><span style="--shiki-default:#79B8FF">uid</span><span style="--shiki-default:#9ECBFF">,</span><span style="--shiki-default:#F97583">name</span><span style="--shiki-default:#F97583"> FROM</span><span style="--shiki-default:#9ECBFF"> users u, </span><span style="--shiki-default:#F97583">sessions</span><span style="--shiki-default:#9ECBFF"> s </span><span style="--shiki-default:#F97583">WHERE</span><span style="--shiki-default:#79B8FF"> u</span><span style="--shiki-default:#9ECBFF">.</span><span style="--shiki-default:#79B8FF">uid</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF">s</span><span style="--shiki-default:#9ECBFF">.</span><span style="--shiki-default:#79B8FF">uid</span><span style="--shiki-default:#F97583"> AND</span><span style="--shiki-default:#79B8FF"> s</span><span style="--shiki-default:#9ECBFF">.</span><span style="--shiki-default:#79B8FF">sid</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF">&quot;&#39;</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#E1E4E8">$sessioncookie</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#9ECBFF">&#39;&quot;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="62"><span style="--shiki-default:#E1E4E8">    $result </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF"> mysql_query</span><span style="--shiki-default:#E1E4E8">($sql);
</span></span><span class="line" line="63"><span emptylineplaceholder="true">
</span></span><span class="line" line="64"><span style="--shiki-default:#F97583">    if</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#79B8FF">mysql_num_rows</span><span style="--shiki-default:#E1E4E8">($result) </span><span style="--shiki-default:#F97583">&amp;</span><span style="--shiki-default:#79B8FF">gt</span><span style="--shiki-default:#E1E4E8">; </span><span style="--shiki-default:#79B8FF">0</span><span style="--shiki-default:#E1E4E8">) {
</span></span><span class="line" line="65"><span style="--shiki-default:#E1E4E8">      $row </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF"> mysql_fetch_array</span><span style="--shiki-default:#E1E4E8">($result);
</span></span><span class="line" line="66"><span style="--shiki-default:#E1E4E8">      $uid </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $row[</span><span style="--shiki-default:#9ECBFF">&#39;uid&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="67"><span style="--shiki-default:#E1E4E8">      $username </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $row[</span><span style="--shiki-default:#9ECBFF">&#39;name&#39;</span><span style="--shiki-default:#E1E4E8">];
</span></span><span class="line" line="68"><span style="--shiki-default:#F97583">      break</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="69"><span style="--shiki-default:#E1E4E8">    } </span><span style="--shiki-default:#F97583">else</span><span style="--shiki-default:#F97583"> continue</span><span style="--shiki-default:#E1E4E8">; </span><span style="--shiki-default:#6A737D">// No rows found, so on to the next cookie
</span></span><span class="line" line="70"><span style="--shiki-default:#E1E4E8">  }
</span></span><span class="line" line="71"><span emptylineplaceholder="true">
</span></span><span class="line" line="72"><span style="--shiki-default:#6A737D">  // If we have user details after the loop, user is authenticated
</span></span><span class="line" line="73"><span style="--shiki-default:#F97583">  if</span><span style="--shiki-default:#E1E4E8">($uid </span><span style="--shiki-default:#F97583">!=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#F97583"> &amp;</span><span style="--shiki-default:#79B8FF">amp</span><span style="--shiki-default:#E1E4E8">;</span><span style="--shiki-default:#F97583">&amp;</span><span style="--shiki-default:#79B8FF">amp</span><span style="--shiki-default:#E1E4E8">; $username </span><span style="--shiki-default:#F97583">!=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">) </span><span style="--shiki-default:#F97583">return</span><span style="--shiki-default:#79B8FF"> true</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="74"><span emptylineplaceholder="true">
</span></span><span class="line" line="75"><span style="--shiki-default:#6A737D">  // All cookies have been checked, and all have failed
</span></span><span class="line" line="76"><span style="--shiki-default:#F97583">  return</span><span style="--shiki-default:#79B8FF"> false</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="77"><span style="--shiki-default:#E1E4E8">}</span><span style="--shiki-default:#F97583">&lt;/</span><span style="--shiki-default:#79B8FF">n00batnospamn00bsys0p</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#79B8FF">co</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#79B8FF">uk</span><span style="--shiki-default:#F97583">&gt;
</span></span></code><!--]--></pre></div></div><p><!--[-->The next function of note, is the one which matches the name of a file, unavailable to the outside world, except via this script. If you know any PHP at all, it&#39;s pretty simple. You fire it a number, and it tells you if there&#39;s a filename attached.<!--]--></p><div language="php" meta style=""><div class="border shadow-lg bg-code_background my-2 rounded-md py-3 px-5 group overflow-x-auto"><div class="flex sm:grid sm:grid-cols-3 mb-3 justify-between items-center"><div class="flex gap-2"><div class="size-3 rounded-full bg-[#FE5F57] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#FEBC2E] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#28C840] hidden group-hover:block"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div></div><div class="font-mono text-xs text-center dark:text-white/60 max-sm:truncate"></div><div class="flex justify-end text-zinc-50"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy-icon cursor-pointer opacity-50"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></div></div><pre class="language-php shiki shiki-themes github-dark my-0 font-[500] bg-transparent leading-normal font-mono"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">/**
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D"> *  Match the number given to a filename to download.
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D"> *  return  string  String will either be a filename or blank
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="6"><span style="--shiki-default:#6A737D"> **/
</span></span><span class="line" line="7"><span style="--shiki-default:#F97583">function</span><span style="--shiki-default:#B392F0"> getFileName</span><span style="--shiki-default:#E1E4E8">($filenum) {
</span></span><span class="line" line="8"><span style="--shiki-default:#E1E4E8">  $fname </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="9"><span style="--shiki-default:#6A737D">  // Check for a single number in the input
</span></span><span class="line" line="10"><span style="--shiki-default:#F97583">  if</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#F97583">!</span><span style="--shiki-default:#79B8FF">preg_match</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;/</span><span style="--shiki-default:#F97583">^</span><span style="--shiki-default:#DBEDFF">[0-9]</span><span style="--shiki-default:#F97583">$</span><span style="--shiki-default:#9ECBFF">/&quot;</span><span style="--shiki-default:#E1E4E8">, $filenum)) </span><span style="--shiki-default:#F97583">return</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="11"><span style="--shiki-default:#F97583">  switch</span><span style="--shiki-default:#E1E4E8">($filenum) {
</span></span><span class="line" line="12"><span style="--shiki-default:#F97583">    case</span><span style="--shiki-default:#79B8FF"> 1</span><span style="--shiki-default:#E1E4E8">:
</span></span><span class="line" line="13"><span style="--shiki-default:#E1E4E8">      $fname </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;UserManual.pdf&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="14"><span style="--shiki-default:#F97583">      break</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="15"><span style="--shiki-default:#F97583">    case</span><span style="--shiki-default:#79B8FF"> 2</span><span style="--shiki-default:#E1E4E8">:
</span></span><span class="line" line="16"><span style="--shiki-default:#E1E4E8">      $fname </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF"> &#39;EngineerManual.pdf&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="17"><span style="--shiki-default:#F97583">      break</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="18"><span style="--shiki-default:#E1E4E8">  }
</span></span><span class="line" line="19"><span style="--shiki-default:#F97583">  return</span><span style="--shiki-default:#E1E4E8"> $fname;
</span></span><span class="line" line="20"><span style="--shiki-default:#E1E4E8">}
</span></span></code><!--]--></pre></div></div><p><!--[-->The next function just does a meta http refresh after 3 seconds back to the referring page.<!--]--></p><div language="php" meta style=""><div class="border shadow-lg bg-code_background my-2 rounded-md py-3 px-5 group overflow-x-auto"><div class="flex sm:grid sm:grid-cols-3 mb-3 justify-between items-center"><div class="flex gap-2"><div class="size-3 rounded-full bg-[#FE5F57] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#FEBC2E] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#28C840] hidden group-hover:block"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div></div><div class="font-mono text-xs text-center dark:text-white/60 max-sm:truncate"></div><div class="flex justify-end text-zinc-50"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy-icon cursor-pointer opacity-50"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></div></div><pre class="language-php shiki shiki-themes github-dark my-0 font-[500] bg-transparent leading-normal font-mono"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">/**
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D"> *  Redirect to the referring page
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D"> * return   n/a
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D"> **/
</span></span><span class="line" line="6"><span style="--shiki-default:#F97583">function</span><span style="--shiki-default:#B392F0"> redirectToPrevious</span><span style="--shiki-default:#E1E4E8">() {
</span></span><span class="line" line="7"><span style="--shiki-default:#79B8FF">  echo</span><span style="--shiki-default:#9ECBFF"> &quot;&lt;meta http-equiv=&quot;</span><span style="--shiki-default:#79B8FF">Refresh</span><span style="--shiki-default:#9ECBFF">&quot; content=&#39;</span><span style="--shiki-default:#79B8FF">\&quot;</span><span style="--shiki-default:#9ECBFF">3;&#39; url=&quot;</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#E1E4E8">$_SERVER[</span><span style="--shiki-default:#79B8FF">HTTP_REFERER</span><span style="--shiki-default:#E1E4E8">]</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#9ECBFF">&quot;&gt;&quot;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="8"><span style="--shiki-default:#E1E4E8">}
</span></span></code><!--]--></pre></div></div><p><!--[-->The last function just reads a file from somewhere on the filesystem on the fly, and passes it to the user.<!--]--></p><div language="php" meta style=""><div class="border shadow-lg bg-code_background my-2 rounded-md py-3 px-5 group overflow-x-auto"><div class="flex sm:grid sm:grid-cols-3 mb-3 justify-between items-center"><div class="flex gap-2"><div class="size-3 rounded-full bg-[#FE5F57] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#FEBC2E] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#28C840] hidden group-hover:block"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div></div><div class="font-mono text-xs text-center dark:text-white/60 max-sm:truncate"></div><div class="flex justify-end text-zinc-50"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy-icon cursor-pointer opacity-50"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></div></div><pre class="language-php shiki shiki-themes github-dark my-0 font-[500] bg-transparent leading-normal font-mono"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">/**
</span></span><span class="line" line="2"><span style="--shiki-default:#6A737D"> *  Pass a download link to the user.
</span></span><span class="line" line="3"><span style="--shiki-default:#6A737D"> *
</span></span><span class="line" line="4"><span style="--shiki-default:#6A737D"> *  return  n/a
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D"> **/
</span></span><span class="line" line="6"><span style="--shiki-default:#F97583">function</span><span style="--shiki-default:#B392F0"> downloadFile</span><span style="--shiki-default:#E1E4E8">($file) {
</span></span><span class="line" line="7"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;Content-type: application/force-download&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="8"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;Content-Transfer-Encoding: Binary&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="9"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;Content-length: &quot;</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#79B8FF">filesize</span><span style="--shiki-default:#E1E4E8">($file));
</span></span><span class="line" line="10"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;Content-disposition: attachment; filename=</span><span style="--shiki-default:#79B8FF">\&quot;</span><span style="--shiki-default:#9ECBFF">&quot;</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#79B8FF">basename</span><span style="--shiki-default:#E1E4E8">($file)</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#9ECBFF">&quot;</span><span style="--shiki-default:#79B8FF">\&quot;</span><span style="--shiki-default:#9ECBFF">&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="11"><span style="--shiki-default:#79B8FF">  readfile</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;</span><span style="--shiki-default:#E1E4E8">$file</span><span style="--shiki-default:#9ECBFF">&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="12"><span style="--shiki-default:#E1E4E8">}
</span></span></code><!--]--></pre></div></div><p><!--[-->Here&#39;s the code for the script file itself. It&#39;s pretty self explanatory. $dir is the folder outside the web folder&#39;s accessible area, but still accessible by Apache (for those of you running in a chroot).<!--]--></p><div language="php" meta style=""><div class="border shadow-lg bg-code_background my-2 rounded-md py-3 px-5 group overflow-x-auto"><div class="flex sm:grid sm:grid-cols-3 mb-3 justify-between items-center"><div class="flex gap-2"><div class="size-3 rounded-full bg-[#FE5F57] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#FEBC2E] hidden group-hover:block"></div><div class="size-3 rounded-full bg-[#28C840] hidden group-hover:block"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div><div class="size-3 rounded-full dark:bg-gray-600 bg-neutral-400 group-hover:hidden"></div></div><div class="font-mono text-xs text-center dark:text-white/60 max-sm:truncate"></div><div class="flex justify-end text-zinc-50"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy-icon cursor-pointer opacity-50"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></div></div><pre class="language-php shiki shiki-themes github-dark my-0 font-[500] bg-transparent leading-normal font-mono"><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A737D">// Set variables.
</span></span><span class="line" line="2"><span style="--shiki-default:#E1E4E8">$dir</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF">&#39;/srv/filerepo/&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="3"><span style="--shiki-default:#E1E4E8">$filename</span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#9ECBFF">&#39;&#39;</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#6A737D">// Check authentication
</span></span><span class="line" line="6"><span style="--shiki-default:#F97583">if</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#F97583">!</span><span style="--shiki-default:#B392F0">checkAuth</span><span style="--shiki-default:#E1E4E8">()) {
</span></span><span class="line" line="7"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&quot;HTTP/1.1 403 Forbidden&quot;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="8"><span style="--shiki-default:#F97583">  exit</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="9"><span style="--shiki-default:#E1E4E8">}
</span></span><span class="line" line="10"><span emptylineplaceholder="true">
</span></span><span class="line" line="11"><span style="--shiki-default:#6A737D">// Sanitise user input by only allowing digits
</span></span><span class="line" line="12"><span style="--shiki-default:#E1E4E8">$getnum </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#79B8FF"> filter_input</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#79B8FF">INPUT_GET</span><span style="--shiki-default:#E1E4E8">, </span><span style="--shiki-default:#9ECBFF">&#39;file&#39;</span><span style="--shiki-default:#E1E4E8">, </span><span style="--shiki-default:#79B8FF">FILTER_SANITIZE_NUMBER_INT</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#6A737D">// Process input and download file
</span></span><span class="line" line="15"><span style="--shiki-default:#E1E4E8">$filename </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#B392F0"> getFileName</span><span style="--shiki-default:#E1E4E8">($getnum);
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span style="--shiki-default:#F97583">if</span><span style="--shiki-default:#E1E4E8">($filename </span><span style="--shiki-default:#F97583">==</span><span style="--shiki-default:#9ECBFF"> &#39;&#39;</span><span style="--shiki-default:#E1E4E8">) {
</span></span><span class="line" line="18"><span style="--shiki-default:#79B8FF">  header</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;HTTP/1.0 404 Not Found&#39;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="19"><span style="--shiki-default:#F97583">  include</span><span style="--shiki-default:#E1E4E8">(</span><span style="--shiki-default:#9ECBFF">&#39;404.php&#39;</span><span style="--shiki-default:#E1E4E8">);
</span></span><span class="line" line="20"><span style="--shiki-default:#F97583">  exit</span><span style="--shiki-default:#E1E4E8">;
</span></span><span class="line" line="21"><span style="--shiki-default:#E1E4E8">}
</span></span><span class="line" line="22"><span emptylineplaceholder="true">
</span></span><span class="line" line="23"><span style="--shiki-default:#E1E4E8">$file </span><span style="--shiki-default:#F97583">=</span><span style="--shiki-default:#E1E4E8"> $dir</span><span style="--shiki-default:#F97583">.</span><span style="--shiki-default:#E1E4E8">$filename;
</span></span><span class="line" line="24"><span style="--shiki-default:#B392F0">downloadFile</span><span style="--shiki-default:#E1E4E8">($file);
</span></span><span class="line" line="25"><span emptylineplaceholder="true">
</span></span><span class="line" line="26"><span style="--shiki-default:#B392F0">redirectToPrevious</span><span style="--shiki-default:#E1E4E8">();
</span></span></code><!--]--></pre></div></div><p><!--[-->As always, folks, feel free to leave me feedback in the comments, or via my contact form!<!--]--></p><p><!--[-->n00b<!--]--></p><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div><!--]--></div></article></section></div></div></main></div><!--]--></div></div><div id="teleports"></div></body></html>