[{"data":1,"prerenderedAt":730},["ShallowReactive",2],{"post":3,"content-query-ijWCVzGFG0":424},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"imagesource":10,"imagecredit":11,"imageFilename":12,"createdAt":13,"updatedAt":13,"readingTime":14,"body":19,"_type":418,"_id":419,"_source":420,"_file":421,"_stem":422,"_extension":423},"/posts/puppetlabs-puppet-mysql-mariadb-centos","posts",false,"","Official Puppet Mysql & MariaDB on CentOS","Making the puppetlabs-mysql official Puppet module work with the official MariaDB CentOS repositories.","https://www.flickr.com/photos/eschipul/5047874345/","Ed Schipul","2015.07.12T060000_puppetlabs-puppet-mysql-mariadb-centos.png","2015-07-12T06:00:00",{"text":15,"minutes":16,"time":17,"words":18},"1 min read",0.255,15300,51,{"type":20,"children":21,"toc":416},"root",[22,30,35,40,60,75,385,405,410],{"type":23,"tag":24,"props":25,"children":26},"element","p",{},[27],{"type":28,"value":29},"text","Hi all,",{"type":23,"tag":24,"props":31,"children":32},{},[33],{"type":28,"value":34},"Today, I'm going to cover making the official puppetlabs-mysql usable with the MariaDB official repositories on CentOS. For some completely incomprehensible reason, the official MariaDB RPMs for CentOS6 don’t create the MariaDB folder in /var/run, meaning that we have to crack out a little hack to make the puppetlabs-mysql Puppet module work as it's intended.",{"type":23,"tag":24,"props":36,"children":37},{},[38],{"type":28,"value":39},"The process will cover the following steps:",{"type":23,"tag":41,"props":42,"children":43},"ul",{},[44,50,55],{"type":23,"tag":45,"props":46,"children":47},"li",{},[48],{"type":28,"value":49},"Manage the MariaDB package ourselves",{"type":23,"tag":45,"props":51,"children":52},{},[53],{"type":28,"value":54},"Manually create the MariaDB rundir",{"type":23,"tag":45,"props":56,"children":57},{},[58],{"type":28,"value":59},"Ensure proper ownership of the rundir",{"type":23,"tag":24,"props":61,"children":62},{},[63,65,73],{"type":28,"value":64},"I'll assume you've already added the MariaDB repository to your copy of CentOS. If not, the ",{"type":23,"tag":66,"props":67,"children":70},"a",{"href":68,"target":69},"https://downloads.mariadb.org/mariadb/repositories/","_blank",[71],{"type":28,"value":72},"excellent guides on the MariaDB website",{"type":28,"value":74}," should be enough to get you started. I'm going to put the code directly into a node classification, but you can do it pretty much anywhere you like. If you need to use this code more than once, consider putting it in a definition or class of its own.",{"type":23,"tag":76,"props":77,"children":81},"pre",{"className":78,"code":79,"language":80,"meta":7,"style":7},"language-puppet shiki shiki-themes github-dark","node 'puppet-mariadb.alexshepherd.me' {\n    $mariadb_package_name = ‘MariaDB-Server’\n    $mariadb_service_name = ‘mysql’\n\n    package { \"mysql-server\":\n        ensure =&gt; installed,\n        name =&gt; $mariadb_package_name\n    } -&gt;\n    file { 'mysql_rundir':\n        path =&gt; '/var/run/mysqld',\n        ensure =&gt; directory,\n        owner =&gt; 'mysql',\n        group =&gt; 'mysql'\n    } -&gt;\n    class { '::mysql::server':\n        package_manage =&gt; false,\n        package_name =&gt; $mariadb_package_name,\n        service_name =&gt; $mariadb_service_name\n    }\n}\n","puppet",[82],{"type":23,"tag":83,"props":84,"children":85},"code",{"__ignoreMap":7},[86,110,139,148,158,182,191,200,209,231,250,269,287,301,309,331,349,358,367,376],{"type":23,"tag":87,"props":88,"children":91},"span",{"class":89,"line":90},"line",1,[92,98,104],{"type":23,"tag":87,"props":93,"children":95},{"style":94},"--shiki-default:#F97583",[96],{"type":28,"value":97},"node",{"type":23,"tag":87,"props":99,"children":101},{"style":100},"--shiki-default:#9ECBFF",[102],{"type":28,"value":103}," 'puppet-mariadb.alexshepherd.me'",{"type":23,"tag":87,"props":105,"children":107},{"style":106},"--shiki-default:#E1E4E8",[108],{"type":28,"value":109}," {\n",{"type":23,"tag":87,"props":111,"children":113},{"class":89,"line":112},2,[114,119,124,129,134],{"type":23,"tag":87,"props":115,"children":116},{"style":106},[117],{"type":28,"value":118},"    $mariadb_package_name = ‘",{"type":23,"tag":87,"props":120,"children":121},{"style":94},[122],{"type":28,"value":123},"MariaDB",{"type":23,"tag":87,"props":125,"children":126},{"style":106},[127],{"type":28,"value":128},"-",{"type":23,"tag":87,"props":130,"children":131},{"style":94},[132],{"type":28,"value":133},"Server",{"type":23,"tag":87,"props":135,"children":136},{"style":106},[137],{"type":28,"value":138},"’\n",{"type":23,"tag":87,"props":140,"children":142},{"class":89,"line":141},3,[143],{"type":23,"tag":87,"props":144,"children":145},{"style":106},[146],{"type":28,"value":147},"    $mariadb_service_name = ‘mysql’\n",{"type":23,"tag":87,"props":149,"children":151},{"class":89,"line":150},4,[152],{"type":23,"tag":87,"props":153,"children":155},{"emptyLinePlaceholder":154},true,[156],{"type":28,"value":157},"\n",{"type":23,"tag":87,"props":159,"children":161},{"class":89,"line":160},5,[162,167,172,177],{"type":23,"tag":87,"props":163,"children":164},{"style":94},[165],{"type":28,"value":166},"    package",{"type":23,"tag":87,"props":168,"children":169},{"style":106},[170],{"type":28,"value":171}," { ",{"type":23,"tag":87,"props":173,"children":174},{"style":100},[175],{"type":28,"value":176},"\"mysql-server\"",{"type":23,"tag":87,"props":178,"children":179},{"style":106},[180],{"type":28,"value":181},":\n",{"type":23,"tag":87,"props":183,"children":185},{"class":89,"line":184},6,[186],{"type":23,"tag":87,"props":187,"children":188},{"style":106},[189],{"type":28,"value":190},"        ensure =&gt; installed,\n",{"type":23,"tag":87,"props":192,"children":194},{"class":89,"line":193},7,[195],{"type":23,"tag":87,"props":196,"children":197},{"style":106},[198],{"type":28,"value":199},"        name =&gt; $mariadb_package_name\n",{"type":23,"tag":87,"props":201,"children":203},{"class":89,"line":202},8,[204],{"type":23,"tag":87,"props":205,"children":206},{"style":106},[207],{"type":28,"value":208},"    } -&gt;\n",{"type":23,"tag":87,"props":210,"children":212},{"class":89,"line":211},9,[213,218,222,227],{"type":23,"tag":87,"props":214,"children":215},{"style":94},[216],{"type":28,"value":217},"    file",{"type":23,"tag":87,"props":219,"children":220},{"style":106},[221],{"type":28,"value":171},{"type":23,"tag":87,"props":223,"children":224},{"style":100},[225],{"type":28,"value":226},"'mysql_rundir'",{"type":23,"tag":87,"props":228,"children":229},{"style":106},[230],{"type":28,"value":181},{"type":23,"tag":87,"props":232,"children":234},{"class":89,"line":233},10,[235,240,245],{"type":23,"tag":87,"props":236,"children":237},{"style":106},[238],{"type":28,"value":239},"        path =&gt; ",{"type":23,"tag":87,"props":241,"children":242},{"style":100},[243],{"type":28,"value":244},"'/var/run/mysqld'",{"type":23,"tag":87,"props":246,"children":247},{"style":106},[248],{"type":28,"value":249},",\n",{"type":23,"tag":87,"props":251,"children":253},{"class":89,"line":252},11,[254,259,265],{"type":23,"tag":87,"props":255,"children":256},{"style":106},[257],{"type":28,"value":258},"        ensure =&gt; ",{"type":23,"tag":87,"props":260,"children":262},{"style":261},"--shiki-default:#79B8FF",[263],{"type":28,"value":264},"directory",{"type":23,"tag":87,"props":266,"children":267},{"style":106},[268],{"type":28,"value":249},{"type":23,"tag":87,"props":270,"children":272},{"class":89,"line":271},12,[273,278,283],{"type":23,"tag":87,"props":274,"children":275},{"style":106},[276],{"type":28,"value":277},"        owner =&gt; ",{"type":23,"tag":87,"props":279,"children":280},{"style":100},[281],{"type":28,"value":282},"'mysql'",{"type":23,"tag":87,"props":284,"children":285},{"style":106},[286],{"type":28,"value":249},{"type":23,"tag":87,"props":288,"children":290},{"class":89,"line":289},13,[291,296],{"type":23,"tag":87,"props":292,"children":293},{"style":106},[294],{"type":28,"value":295},"        group =&gt; ",{"type":23,"tag":87,"props":297,"children":298},{"style":100},[299],{"type":28,"value":300},"'mysql'\n",{"type":23,"tag":87,"props":302,"children":304},{"class":89,"line":303},14,[305],{"type":23,"tag":87,"props":306,"children":307},{"style":106},[308],{"type":28,"value":208},{"type":23,"tag":87,"props":310,"children":312},{"class":89,"line":311},15,[313,318,322,327],{"type":23,"tag":87,"props":314,"children":315},{"style":94},[316],{"type":28,"value":317},"    class",{"type":23,"tag":87,"props":319,"children":320},{"style":106},[321],{"type":28,"value":171},{"type":23,"tag":87,"props":323,"children":324},{"style":100},[325],{"type":28,"value":326},"'::mysql::server'",{"type":23,"tag":87,"props":328,"children":329},{"style":106},[330],{"type":28,"value":181},{"type":23,"tag":87,"props":332,"children":334},{"class":89,"line":333},16,[335,340,345],{"type":23,"tag":87,"props":336,"children":337},{"style":106},[338],{"type":28,"value":339},"        package_manage =&gt; ",{"type":23,"tag":87,"props":341,"children":342},{"style":261},[343],{"type":28,"value":344},"false",{"type":23,"tag":87,"props":346,"children":347},{"style":106},[348],{"type":28,"value":249},{"type":23,"tag":87,"props":350,"children":352},{"class":89,"line":351},17,[353],{"type":23,"tag":87,"props":354,"children":355},{"style":106},[356],{"type":28,"value":357},"        package_name =&gt; $mariadb_package_name,\n",{"type":23,"tag":87,"props":359,"children":361},{"class":89,"line":360},18,[362],{"type":23,"tag":87,"props":363,"children":364},{"style":106},[365],{"type":28,"value":366},"        service_name =&gt; $mariadb_service_name\n",{"type":23,"tag":87,"props":368,"children":370},{"class":89,"line":369},19,[371],{"type":23,"tag":87,"props":372,"children":373},{"style":106},[374],{"type":28,"value":375},"    }\n",{"type":23,"tag":87,"props":377,"children":379},{"class":89,"line":378},20,[380],{"type":23,"tag":87,"props":381,"children":382},{"style":106},[383],{"type":28,"value":384},"}\n",{"type":23,"tag":24,"props":386,"children":387},{},[388,390,396,398,403],{"type":28,"value":389},"It is important that we use this exact dependency sequence, and these exact options in order to make it work. Particularly, the puppetlabs-mysql module depends on a package called ",{"type":23,"tag":391,"props":392,"children":393},"i",{},[394],{"type":28,"value":395},"mysql-server",{"type":28,"value":397},", so we alias it using the ",{"type":23,"tag":391,"props":399,"children":400},{},[401],{"type":28,"value":402},"name",{"type":28,"value":404}," attribute on the package resource We also need to include package_name on ::mysql::server, as there are internal dependencies that cause issues if we don't set it, even though we choose specifically not to manage the package with the module.",{"type":23,"tag":24,"props":406,"children":407},{},[408],{"type":28,"value":409},"Puppet, while an amazing tool that solves so many issues, does still feel a little hackish in places, but we wouldn't be managing servers if we minded performing the odd messy hack where appropriate! That's all for today - expect more devops-related posts moving forwards.",{"type":23,"tag":411,"props":412,"children":413},"style",{},[414],{"type":28,"value":415},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":112,"depth":112,"links":417},[],"markdown","content:posts:2015-07-12-puppetlabs-puppet-mysql-mariadb-centos.md","content","posts/2015-07-12-puppetlabs-puppet-mysql-mariadb-centos.md","posts/2015-07-12-puppetlabs-puppet-mysql-mariadb-centos","md",{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"imagesource":10,"imagecredit":11,"imageFilename":12,"createdAt":13,"updatedAt":13,"readingTime":425,"body":426,"_type":418,"_id":419,"_source":420,"_file":421,"_stem":422,"_extension":423},{"text":15,"minutes":16,"time":17,"words":18},{"type":20,"children":427,"toc":728},[428,432,436,440,455,464,706,720,724],{"type":23,"tag":24,"props":429,"children":430},{},[431],{"type":28,"value":29},{"type":23,"tag":24,"props":433,"children":434},{},[435],{"type":28,"value":34},{"type":23,"tag":24,"props":437,"children":438},{},[439],{"type":28,"value":39},{"type":23,"tag":41,"props":441,"children":442},{},[443,447,451],{"type":23,"tag":45,"props":444,"children":445},{},[446],{"type":28,"value":49},{"type":23,"tag":45,"props":448,"children":449},{},[450],{"type":28,"value":54},{"type":23,"tag":45,"props":452,"children":453},{},[454],{"type":28,"value":59},{"type":23,"tag":24,"props":456,"children":457},{},[458,459,463],{"type":28,"value":64},{"type":23,"tag":66,"props":460,"children":461},{"href":68,"target":69},[462],{"type":28,"value":72},{"type":28,"value":74},{"type":23,"tag":76,"props":465,"children":466},{"className":78,"code":79,"language":80,"meta":7,"style":7},[467],{"type":23,"tag":83,"props":468,"children":469},{"__ignoreMap":7},[470,485,508,515,522,541,548,555,562,581,596,611,626,637,644,663,678,685,692,699],{"type":23,"tag":87,"props":471,"children":472},{"class":89,"line":90},[473,477,481],{"type":23,"tag":87,"props":474,"children":475},{"style":94},[476],{"type":28,"value":97},{"type":23,"tag":87,"props":478,"children":479},{"style":100},[480],{"type":28,"value":103},{"type":23,"tag":87,"props":482,"children":483},{"style":106},[484],{"type":28,"value":109},{"type":23,"tag":87,"props":486,"children":487},{"class":89,"line":112},[488,492,496,500,504],{"type":23,"tag":87,"props":489,"children":490},{"style":106},[491],{"type":28,"value":118},{"type":23,"tag":87,"props":493,"children":494},{"style":94},[495],{"type":28,"value":123},{"type":23,"tag":87,"props":497,"children":498},{"style":106},[499],{"type":28,"value":128},{"type":23,"tag":87,"props":501,"children":502},{"style":94},[503],{"type":28,"value":133},{"type":23,"tag":87,"props":505,"children":506},{"style":106},[507],{"type":28,"value":138},{"type":23,"tag":87,"props":509,"children":510},{"class":89,"line":141},[511],{"type":23,"tag":87,"props":512,"children":513},{"style":106},[514],{"type":28,"value":147},{"type":23,"tag":87,"props":516,"children":517},{"class":89,"line":150},[518],{"type":23,"tag":87,"props":519,"children":520},{"emptyLinePlaceholder":154},[521],{"type":28,"value":157},{"type":23,"tag":87,"props":523,"children":524},{"class":89,"line":160},[525,529,533,537],{"type":23,"tag":87,"props":526,"children":527},{"style":94},[528],{"type":28,"value":166},{"type":23,"tag":87,"props":530,"children":531},{"style":106},[532],{"type":28,"value":171},{"type":23,"tag":87,"props":534,"children":535},{"style":100},[536],{"type":28,"value":176},{"type":23,"tag":87,"props":538,"children":539},{"style":106},[540],{"type":28,"value":181},{"type":23,"tag":87,"props":542,"children":543},{"class":89,"line":184},[544],{"type":23,"tag":87,"props":545,"children":546},{"style":106},[547],{"type":28,"value":190},{"type":23,"tag":87,"props":549,"children":550},{"class":89,"line":193},[551],{"type":23,"tag":87,"props":552,"children":553},{"style":106},[554],{"type":28,"value":199},{"type":23,"tag":87,"props":556,"children":557},{"class":89,"line":202},[558],{"type":23,"tag":87,"props":559,"children":560},{"style":106},[561],{"type":28,"value":208},{"type":23,"tag":87,"props":563,"children":564},{"class":89,"line":211},[565,569,573,577],{"type":23,"tag":87,"props":566,"children":567},{"style":94},[568],{"type":28,"value":217},{"type":23,"tag":87,"props":570,"children":571},{"style":106},[572],{"type":28,"value":171},{"type":23,"tag":87,"props":574,"children":575},{"style":100},[576],{"type":28,"value":226},{"type":23,"tag":87,"props":578,"children":579},{"style":106},[580],{"type":28,"value":181},{"type":23,"tag":87,"props":582,"children":583},{"class":89,"line":233},[584,588,592],{"type":23,"tag":87,"props":585,"children":586},{"style":106},[587],{"type":28,"value":239},{"type":23,"tag":87,"props":589,"children":590},{"style":100},[591],{"type":28,"value":244},{"type":23,"tag":87,"props":593,"children":594},{"style":106},[595],{"type":28,"value":249},{"type":23,"tag":87,"props":597,"children":598},{"class":89,"line":252},[599,603,607],{"type":23,"tag":87,"props":600,"children":601},{"style":106},[602],{"type":28,"value":258},{"type":23,"tag":87,"props":604,"children":605},{"style":261},[606],{"type":28,"value":264},{"type":23,"tag":87,"props":608,"children":609},{"style":106},[610],{"type":28,"value":249},{"type":23,"tag":87,"props":612,"children":613},{"class":89,"line":271},[614,618,622],{"type":23,"tag":87,"props":615,"children":616},{"style":106},[617],{"type":28,"value":277},{"type":23,"tag":87,"props":619,"children":620},{"style":100},[621],{"type":28,"value":282},{"type":23,"tag":87,"props":623,"children":624},{"style":106},[625],{"type":28,"value":249},{"type":23,"tag":87,"props":627,"children":628},{"class":89,"line":289},[629,633],{"type":23,"tag":87,"props":630,"children":631},{"style":106},[632],{"type":28,"value":295},{"type":23,"tag":87,"props":634,"children":635},{"style":100},[636],{"type":28,"value":300},{"type":23,"tag":87,"props":638,"children":639},{"class":89,"line":303},[640],{"type":23,"tag":87,"props":641,"children":642},{"style":106},[643],{"type":28,"value":208},{"type":23,"tag":87,"props":645,"children":646},{"class":89,"line":311},[647,651,655,659],{"type":23,"tag":87,"props":648,"children":649},{"style":94},[650],{"type":28,"value":317},{"type":23,"tag":87,"props":652,"children":653},{"style":106},[654],{"type":28,"value":171},{"type":23,"tag":87,"props":656,"children":657},{"style":100},[658],{"type":28,"value":326},{"type":23,"tag":87,"props":660,"children":661},{"style":106},[662],{"type":28,"value":181},{"type":23,"tag":87,"props":664,"children":665},{"class":89,"line":333},[666,670,674],{"type":23,"tag":87,"props":667,"children":668},{"style":106},[669],{"type":28,"value":339},{"type":23,"tag":87,"props":671,"children":672},{"style":261},[673],{"type":28,"value":344},{"type":23,"tag":87,"props":675,"children":676},{"style":106},[677],{"type":28,"value":249},{"type":23,"tag":87,"props":679,"children":680},{"class":89,"line":351},[681],{"type":23,"tag":87,"props":682,"children":683},{"style":106},[684],{"type":28,"value":357},{"type":23,"tag":87,"props":686,"children":687},{"class":89,"line":360},[688],{"type":23,"tag":87,"props":689,"children":690},{"style":106},[691],{"type":28,"value":366},{"type":23,"tag":87,"props":693,"children":694},{"class":89,"line":369},[695],{"type":23,"tag":87,"props":696,"children":697},{"style":106},[698],{"type":28,"value":375},{"type":23,"tag":87,"props":700,"children":701},{"class":89,"line":378},[702],{"type":23,"tag":87,"props":703,"children":704},{"style":106},[705],{"type":28,"value":384},{"type":23,"tag":24,"props":707,"children":708},{},[709,710,714,715,719],{"type":28,"value":389},{"type":23,"tag":391,"props":711,"children":712},{},[713],{"type":28,"value":395},{"type":28,"value":397},{"type":23,"tag":391,"props":716,"children":717},{},[718],{"type":28,"value":402},{"type":28,"value":404},{"type":23,"tag":24,"props":721,"children":722},{},[723],{"type":28,"value":409},{"type":23,"tag":411,"props":725,"children":726},{},[727],{"type":28,"value":415},{"title":7,"searchDepth":112,"depth":112,"links":729},[],1735624507729]