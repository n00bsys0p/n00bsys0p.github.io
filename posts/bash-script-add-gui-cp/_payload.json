[{"data":1,"prerenderedAt":818},["ShallowReactive",2],{"post":3,"content-query-Mlk8QlWvDA":470},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"imagesource":10,"imagecredit":10,"image":11,"createdAt":12,"updatedAt":12,"readingTime":13,"body":18,"_type":464,"_id":465,"_source":466,"_file":467,"_stem":468,"_extension":469},"/posts/bash-script-add-gui-cp","posts",false,"","BASH script to add GUI to cp","Give the Linux copy command a GUI",null,"2011.07.21T140000_bash-script-add-gui-cp.jpg","2011-07-21T14:00:00",{"text":14,"minutes":15,"time":16,"words":17},"2 min read",1.585,95100,317,{"type":19,"children":20,"toc":462},"root",[21,29,34,379,400,413,425,430,441,446,451,456],{"type":22,"tag":23,"props":24,"children":25},"element","p",{},[26],{"type":27,"value":28},"text","Hi folks!",{"type":22,"tag":23,"props":30,"children":31},{},[32],{"type":27,"value":33},"Got an interesting BASH script for you this time. I regularly use a BASH script to clone a HDD using cp, and other than perhaps using \"-v\", I couldn't think of a way to give it a GUI. A little research and thought into it came up with the following result:",{"type":22,"tag":35,"props":36,"children":40},"pre",{"className":37,"code":38,"language":39,"meta":7,"style":7},"language-bash shiki shiki-themes github-dark","#!/bin/bash\nSRC=\"/mnt\"\nTGT=\"/mnt2\"\n\necho \"Copying $SRC to $TGT\"\n\n[[ -w /tmp/fifo ]] && rm /tmp/fifo\nmkfifo /tmp/fifo\n\nexec 5/tmp/fifo\n(cat \u003C&5\n    if [ ! \"$(ps aux | awk '{print $2}' | grep $CPPID)\" ]; then\n        break\n    fi\n    sleep 10\ndone\n\n5\n","bash",[41],{"type":22,"tag":42,"props":43,"children":44},"code",{"__ignoreMap":7},[45,57,79,97,107,142,150,180,193,201,215,244,322,331,340,354,363,371],{"type":22,"tag":46,"props":47,"children":50},"span",{"class":48,"line":49},"line",1,[51],{"type":22,"tag":46,"props":52,"children":54},{"style":53},"--shiki-default:#6A737D",[55],{"type":27,"value":56},"#!/bin/bash\n",{"type":22,"tag":46,"props":58,"children":60},{"class":48,"line":59},2,[61,67,73],{"type":22,"tag":46,"props":62,"children":64},{"style":63},"--shiki-default:#E1E4E8",[65],{"type":27,"value":66},"SRC",{"type":22,"tag":46,"props":68,"children":70},{"style":69},"--shiki-default:#F97583",[71],{"type":27,"value":72},"=",{"type":22,"tag":46,"props":74,"children":76},{"style":75},"--shiki-default:#9ECBFF",[77],{"type":27,"value":78},"\"/mnt\"\n",{"type":22,"tag":46,"props":80,"children":82},{"class":48,"line":81},3,[83,88,92],{"type":22,"tag":46,"props":84,"children":85},{"style":63},[86],{"type":27,"value":87},"TGT",{"type":22,"tag":46,"props":89,"children":90},{"style":69},[91],{"type":27,"value":72},{"type":22,"tag":46,"props":93,"children":94},{"style":75},[95],{"type":27,"value":96},"\"/mnt2\"\n",{"type":22,"tag":46,"props":98,"children":100},{"class":48,"line":99},4,[101],{"type":22,"tag":46,"props":102,"children":104},{"emptyLinePlaceholder":103},true,[105],{"type":27,"value":106},"\n",{"type":22,"tag":46,"props":108,"children":110},{"class":48,"line":109},5,[111,117,122,127,132,137],{"type":22,"tag":46,"props":112,"children":114},{"style":113},"--shiki-default:#79B8FF",[115],{"type":27,"value":116},"echo",{"type":22,"tag":46,"props":118,"children":119},{"style":75},[120],{"type":27,"value":121}," \"Copying ",{"type":22,"tag":46,"props":123,"children":124},{"style":63},[125],{"type":27,"value":126},"$SRC",{"type":22,"tag":46,"props":128,"children":129},{"style":75},[130],{"type":27,"value":131}," to ",{"type":22,"tag":46,"props":133,"children":134},{"style":63},[135],{"type":27,"value":136},"$TGT",{"type":22,"tag":46,"props":138,"children":139},{"style":75},[140],{"type":27,"value":141},"\"\n",{"type":22,"tag":46,"props":143,"children":145},{"class":48,"line":144},6,[146],{"type":22,"tag":46,"props":147,"children":148},{"emptyLinePlaceholder":103},[149],{"type":27,"value":106},{"type":22,"tag":46,"props":151,"children":153},{"class":48,"line":152},7,[154,159,164,169,175],{"type":22,"tag":46,"props":155,"children":156},{"style":63},[157],{"type":27,"value":158},"[[ ",{"type":22,"tag":46,"props":160,"children":161},{"style":69},[162],{"type":27,"value":163},"-w",{"type":22,"tag":46,"props":165,"children":166},{"style":63},[167],{"type":27,"value":168}," /tmp/fifo ]] && ",{"type":22,"tag":46,"props":170,"children":172},{"style":171},"--shiki-default:#B392F0",[173],{"type":27,"value":174},"rm",{"type":22,"tag":46,"props":176,"children":177},{"style":75},[178],{"type":27,"value":179}," /tmp/fifo\n",{"type":22,"tag":46,"props":181,"children":183},{"class":48,"line":182},8,[184,189],{"type":22,"tag":46,"props":185,"children":186},{"style":171},[187],{"type":27,"value":188},"mkfifo",{"type":22,"tag":46,"props":190,"children":191},{"style":75},[192],{"type":27,"value":179},{"type":22,"tag":46,"props":194,"children":196},{"class":48,"line":195},9,[197],{"type":22,"tag":46,"props":198,"children":199},{"emptyLinePlaceholder":103},[200],{"type":27,"value":106},{"type":22,"tag":46,"props":202,"children":204},{"class":48,"line":203},10,[205,210],{"type":22,"tag":46,"props":206,"children":207},{"style":113},[208],{"type":27,"value":209},"exec",{"type":22,"tag":46,"props":211,"children":212},{"style":75},[213],{"type":27,"value":214}," 5/tmp/fifo\n",{"type":22,"tag":46,"props":216,"children":218},{"class":48,"line":217},11,[219,224,229,234,239],{"type":22,"tag":46,"props":220,"children":221},{"style":63},[222],{"type":27,"value":223},"(",{"type":22,"tag":46,"props":225,"children":226},{"style":171},[227],{"type":27,"value":228},"cat",{"type":22,"tag":46,"props":230,"children":231},{"style":69},[232],{"type":27,"value":233}," \u003C",{"type":22,"tag":46,"props":235,"children":236},{"style":63},[237],{"type":27,"value":238},"&",{"type":22,"tag":46,"props":240,"children":241},{"style":171},[242],{"type":27,"value":243},"5\n",{"type":22,"tag":46,"props":245,"children":247},{"class":48,"line":246},12,[248,253,258,263,268,273,278,283,288,293,297,302,307,312,317],{"type":22,"tag":46,"props":249,"children":250},{"style":69},[251],{"type":27,"value":252},"    if",{"type":22,"tag":46,"props":254,"children":255},{"style":63},[256],{"type":27,"value":257}," [ ",{"type":22,"tag":46,"props":259,"children":260},{"style":69},[261],{"type":27,"value":262},"!",{"type":22,"tag":46,"props":264,"children":265},{"style":75},[266],{"type":27,"value":267}," \"$(",{"type":22,"tag":46,"props":269,"children":270},{"style":171},[271],{"type":27,"value":272},"ps",{"type":22,"tag":46,"props":274,"children":275},{"style":75},[276],{"type":27,"value":277}," aux ",{"type":22,"tag":46,"props":279,"children":280},{"style":69},[281],{"type":27,"value":282},"|",{"type":22,"tag":46,"props":284,"children":285},{"style":171},[286],{"type":27,"value":287}," awk",{"type":22,"tag":46,"props":289,"children":290},{"style":75},[291],{"type":27,"value":292}," '{print $2}' ",{"type":22,"tag":46,"props":294,"children":295},{"style":69},[296],{"type":27,"value":282},{"type":22,"tag":46,"props":298,"children":299},{"style":171},[300],{"type":27,"value":301}," grep",{"type":22,"tag":46,"props":303,"children":304},{"style":63},[305],{"type":27,"value":306}," $CPPID",{"type":22,"tag":46,"props":308,"children":309},{"style":75},[310],{"type":27,"value":311},")\"",{"type":22,"tag":46,"props":313,"children":314},{"style":63},[315],{"type":27,"value":316}," ]; ",{"type":22,"tag":46,"props":318,"children":319},{"style":69},[320],{"type":27,"value":321},"then\n",{"type":22,"tag":46,"props":323,"children":325},{"class":48,"line":324},13,[326],{"type":22,"tag":46,"props":327,"children":328},{"style":69},[329],{"type":27,"value":330},"        break\n",{"type":22,"tag":46,"props":332,"children":334},{"class":48,"line":333},14,[335],{"type":22,"tag":46,"props":336,"children":337},{"style":69},[338],{"type":27,"value":339},"    fi\n",{"type":22,"tag":46,"props":341,"children":343},{"class":48,"line":342},15,[344,349],{"type":22,"tag":46,"props":345,"children":346},{"style":171},[347],{"type":27,"value":348},"    sleep",{"type":22,"tag":46,"props":350,"children":351},{"style":113},[352],{"type":27,"value":353}," 10\n",{"type":22,"tag":46,"props":355,"children":357},{"class":48,"line":356},16,[358],{"type":22,"tag":46,"props":359,"children":360},{"style":69},[361],{"type":27,"value":362},"done\n",{"type":22,"tag":46,"props":364,"children":366},{"class":48,"line":365},17,[367],{"type":22,"tag":46,"props":368,"children":369},{"emptyLinePlaceholder":103},[370],{"type":27,"value":106},{"type":22,"tag":46,"props":372,"children":374},{"class":48,"line":373},18,[375],{"type":22,"tag":46,"props":376,"children":377},{"style":171},[378],{"type":27,"value":243},{"type":22,"tag":23,"props":380,"children":381},{},[382,384,390,392,398],{"type":27,"value":383},"First up, the script sets variables for the locations to copy from and to. These must be mounted volumes in this example, as we use ",{"type":22,"tag":42,"props":385,"children":387},{"className":386},[],[388],{"type":27,"value":389},"df",{"type":27,"value":391}," to detect them. This wouldn't be too difficult to convert to use some other method of working out the size, such as ",{"type":22,"tag":42,"props":393,"children":395},{"className":394},[],[396],{"type":27,"value":397},"du",{"type":27,"value":399},", if you aren't using a mounted volume.",{"type":22,"tag":23,"props":401,"children":402},{},[403,405,411],{"type":27,"value":404},"We then create a pipe called fifo in /tmp. This is how we will feed data to ",{"type":22,"tag":42,"props":406,"children":408},{"className":407},[],[409],{"type":27,"value":410},"dialog",{"type":27,"value":412},".",{"type":22,"tag":23,"props":414,"children":415},{},[416,418,423],{"type":27,"value":417},"Now we connect file descriptor 5 to the pipe, to facilitate the connection to our ncurses dialog, then pipe FD 5 into the ",{"type":22,"tag":42,"props":419,"children":421},{"className":420},[],[422],{"type":27,"value":410},{"type":27,"value":424}," program, yet again forked into the background.",{"type":22,"tag":23,"props":426,"children":427},{},[428],{"type":27,"value":429},"Next, we find the total size of the source partition, and set it to the variable $TOTAL.",{"type":22,"tag":23,"props":431,"children":432},{},[433,435,440],{"type":27,"value":434},"Here we set the copy process off, and fork it into the background, so the script will jump through to the next section, which regularly updates our instance of ",{"type":22,"tag":42,"props":436,"children":438},{"className":437},[],[439],{"type":27,"value":410},{"type":27,"value":412},{"type":22,"tag":23,"props":442,"children":443},{},[444],{"type":27,"value":445},"Here's the interesting bit... We run a while true loop, which every 10 seconds, checks the cumulative size of the target partition ($COPIED), and compares it to $TOTAL by converting it to a percentage, using bc. This number is then fed into the pipe, which we have connected to dialog. Each loop, we also check to see if the copy process is still running, and if not, we break out of the loop.",{"type":22,"tag":23,"props":447,"children":448},{},[449],{"type":27,"value":450},"To clean up, we close the file descriptor 5",{"type":22,"tag":23,"props":452,"children":453},{},[454],{"type":27,"value":455},"n00b\u003C",{"type":22,"tag":457,"props":458,"children":459},"style",{},[460],{"type":27,"value":461},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":59,"depth":59,"links":463},[],"markdown","content:posts:2011-07-21-bash-script-add-gui-cp.md","content","posts/2011-07-21-bash-script-add-gui-cp.md","posts/2011-07-21-bash-script-add-gui-cp","md",{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"imagesource":10,"imagecredit":10,"image":11,"createdAt":12,"updatedAt":12,"readingTime":471,"body":472,"_type":464,"_id":465,"_source":466,"_file":467,"_stem":468,"_extension":469},{"text":14,"minutes":15,"time":16,"words":17},{"type":19,"children":473,"toc":816},[474,478,482,750,766,776,786,790,800,804,808,812],{"type":22,"tag":23,"props":475,"children":476},{},[477],{"type":27,"value":28},{"type":22,"tag":23,"props":479,"children":480},{},[481],{"type":27,"value":33},{"type":22,"tag":35,"props":483,"children":484},{"className":37,"code":38,"language":39,"meta":7,"style":7},[485],{"type":22,"tag":42,"props":486,"children":487},{"__ignoreMap":7},[488,495,510,525,532,559,566,589,600,607,618,641,704,711,718,729,736,743],{"type":22,"tag":46,"props":489,"children":490},{"class":48,"line":49},[491],{"type":22,"tag":46,"props":492,"children":493},{"style":53},[494],{"type":27,"value":56},{"type":22,"tag":46,"props":496,"children":497},{"class":48,"line":59},[498,502,506],{"type":22,"tag":46,"props":499,"children":500},{"style":63},[501],{"type":27,"value":66},{"type":22,"tag":46,"props":503,"children":504},{"style":69},[505],{"type":27,"value":72},{"type":22,"tag":46,"props":507,"children":508},{"style":75},[509],{"type":27,"value":78},{"type":22,"tag":46,"props":511,"children":512},{"class":48,"line":81},[513,517,521],{"type":22,"tag":46,"props":514,"children":515},{"style":63},[516],{"type":27,"value":87},{"type":22,"tag":46,"props":518,"children":519},{"style":69},[520],{"type":27,"value":72},{"type":22,"tag":46,"props":522,"children":523},{"style":75},[524],{"type":27,"value":96},{"type":22,"tag":46,"props":526,"children":527},{"class":48,"line":99},[528],{"type":22,"tag":46,"props":529,"children":530},{"emptyLinePlaceholder":103},[531],{"type":27,"value":106},{"type":22,"tag":46,"props":533,"children":534},{"class":48,"line":109},[535,539,543,547,551,555],{"type":22,"tag":46,"props":536,"children":537},{"style":113},[538],{"type":27,"value":116},{"type":22,"tag":46,"props":540,"children":541},{"style":75},[542],{"type":27,"value":121},{"type":22,"tag":46,"props":544,"children":545},{"style":63},[546],{"type":27,"value":126},{"type":22,"tag":46,"props":548,"children":549},{"style":75},[550],{"type":27,"value":131},{"type":22,"tag":46,"props":552,"children":553},{"style":63},[554],{"type":27,"value":136},{"type":22,"tag":46,"props":556,"children":557},{"style":75},[558],{"type":27,"value":141},{"type":22,"tag":46,"props":560,"children":561},{"class":48,"line":144},[562],{"type":22,"tag":46,"props":563,"children":564},{"emptyLinePlaceholder":103},[565],{"type":27,"value":106},{"type":22,"tag":46,"props":567,"children":568},{"class":48,"line":152},[569,573,577,581,585],{"type":22,"tag":46,"props":570,"children":571},{"style":63},[572],{"type":27,"value":158},{"type":22,"tag":46,"props":574,"children":575},{"style":69},[576],{"type":27,"value":163},{"type":22,"tag":46,"props":578,"children":579},{"style":63},[580],{"type":27,"value":168},{"type":22,"tag":46,"props":582,"children":583},{"style":171},[584],{"type":27,"value":174},{"type":22,"tag":46,"props":586,"children":587},{"style":75},[588],{"type":27,"value":179},{"type":22,"tag":46,"props":590,"children":591},{"class":48,"line":182},[592,596],{"type":22,"tag":46,"props":593,"children":594},{"style":171},[595],{"type":27,"value":188},{"type":22,"tag":46,"props":597,"children":598},{"style":75},[599],{"type":27,"value":179},{"type":22,"tag":46,"props":601,"children":602},{"class":48,"line":195},[603],{"type":22,"tag":46,"props":604,"children":605},{"emptyLinePlaceholder":103},[606],{"type":27,"value":106},{"type":22,"tag":46,"props":608,"children":609},{"class":48,"line":203},[610,614],{"type":22,"tag":46,"props":611,"children":612},{"style":113},[613],{"type":27,"value":209},{"type":22,"tag":46,"props":615,"children":616},{"style":75},[617],{"type":27,"value":214},{"type":22,"tag":46,"props":619,"children":620},{"class":48,"line":217},[621,625,629,633,637],{"type":22,"tag":46,"props":622,"children":623},{"style":63},[624],{"type":27,"value":223},{"type":22,"tag":46,"props":626,"children":627},{"style":171},[628],{"type":27,"value":228},{"type":22,"tag":46,"props":630,"children":631},{"style":69},[632],{"type":27,"value":233},{"type":22,"tag":46,"props":634,"children":635},{"style":63},[636],{"type":27,"value":238},{"type":22,"tag":46,"props":638,"children":639},{"style":171},[640],{"type":27,"value":243},{"type":22,"tag":46,"props":642,"children":643},{"class":48,"line":246},[644,648,652,656,660,664,668,672,676,680,684,688,692,696,700],{"type":22,"tag":46,"props":645,"children":646},{"style":69},[647],{"type":27,"value":252},{"type":22,"tag":46,"props":649,"children":650},{"style":63},[651],{"type":27,"value":257},{"type":22,"tag":46,"props":653,"children":654},{"style":69},[655],{"type":27,"value":262},{"type":22,"tag":46,"props":657,"children":658},{"style":75},[659],{"type":27,"value":267},{"type":22,"tag":46,"props":661,"children":662},{"style":171},[663],{"type":27,"value":272},{"type":22,"tag":46,"props":665,"children":666},{"style":75},[667],{"type":27,"value":277},{"type":22,"tag":46,"props":669,"children":670},{"style":69},[671],{"type":27,"value":282},{"type":22,"tag":46,"props":673,"children":674},{"style":171},[675],{"type":27,"value":287},{"type":22,"tag":46,"props":677,"children":678},{"style":75},[679],{"type":27,"value":292},{"type":22,"tag":46,"props":681,"children":682},{"style":69},[683],{"type":27,"value":282},{"type":22,"tag":46,"props":685,"children":686},{"style":171},[687],{"type":27,"value":301},{"type":22,"tag":46,"props":689,"children":690},{"style":63},[691],{"type":27,"value":306},{"type":22,"tag":46,"props":693,"children":694},{"style":75},[695],{"type":27,"value":311},{"type":22,"tag":46,"props":697,"children":698},{"style":63},[699],{"type":27,"value":316},{"type":22,"tag":46,"props":701,"children":702},{"style":69},[703],{"type":27,"value":321},{"type":22,"tag":46,"props":705,"children":706},{"class":48,"line":324},[707],{"type":22,"tag":46,"props":708,"children":709},{"style":69},[710],{"type":27,"value":330},{"type":22,"tag":46,"props":712,"children":713},{"class":48,"line":333},[714],{"type":22,"tag":46,"props":715,"children":716},{"style":69},[717],{"type":27,"value":339},{"type":22,"tag":46,"props":719,"children":720},{"class":48,"line":342},[721,725],{"type":22,"tag":46,"props":722,"children":723},{"style":171},[724],{"type":27,"value":348},{"type":22,"tag":46,"props":726,"children":727},{"style":113},[728],{"type":27,"value":353},{"type":22,"tag":46,"props":730,"children":731},{"class":48,"line":356},[732],{"type":22,"tag":46,"props":733,"children":734},{"style":69},[735],{"type":27,"value":362},{"type":22,"tag":46,"props":737,"children":738},{"class":48,"line":365},[739],{"type":22,"tag":46,"props":740,"children":741},{"emptyLinePlaceholder":103},[742],{"type":27,"value":106},{"type":22,"tag":46,"props":744,"children":745},{"class":48,"line":373},[746],{"type":22,"tag":46,"props":747,"children":748},{"style":171},[749],{"type":27,"value":243},{"type":22,"tag":23,"props":751,"children":752},{},[753,754,759,760,765],{"type":27,"value":383},{"type":22,"tag":42,"props":755,"children":757},{"className":756},[],[758],{"type":27,"value":389},{"type":27,"value":391},{"type":22,"tag":42,"props":761,"children":763},{"className":762},[],[764],{"type":27,"value":397},{"type":27,"value":399},{"type":22,"tag":23,"props":767,"children":768},{},[769,770,775],{"type":27,"value":404},{"type":22,"tag":42,"props":771,"children":773},{"className":772},[],[774],{"type":27,"value":410},{"type":27,"value":412},{"type":22,"tag":23,"props":777,"children":778},{},[779,780,785],{"type":27,"value":417},{"type":22,"tag":42,"props":781,"children":783},{"className":782},[],[784],{"type":27,"value":410},{"type":27,"value":424},{"type":22,"tag":23,"props":787,"children":788},{},[789],{"type":27,"value":429},{"type":22,"tag":23,"props":791,"children":792},{},[793,794,799],{"type":27,"value":434},{"type":22,"tag":42,"props":795,"children":797},{"className":796},[],[798],{"type":27,"value":410},{"type":27,"value":412},{"type":22,"tag":23,"props":801,"children":802},{},[803],{"type":27,"value":445},{"type":22,"tag":23,"props":805,"children":806},{},[807],{"type":27,"value":450},{"type":22,"tag":23,"props":809,"children":810},{},[811],{"type":27,"value":455},{"type":22,"tag":457,"props":813,"children":814},{},[815],{"type":27,"value":461},{"title":7,"searchDepth":59,"depth":59,"links":817},[],1735475819612]