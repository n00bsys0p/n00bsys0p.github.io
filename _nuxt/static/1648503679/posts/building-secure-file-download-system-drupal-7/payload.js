__NUXT_JSONP__("/posts/building-secure-file-download-system-drupal-7", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO){return {data:[{post:{slug:"building-secure-file-download-system-drupal-7",description:"Drupal authentication based secure file download php script.",title:"Building a secure file download system for Drupal 7",imagesource:al,imagecredit:al,image:"2011.09.08T14:00:00_building-secure-file-download-system-drupal-7.jpg",createdAt:am,updatedAt:am,toc:[],body:{type:"root",children:[{type:b,tag:w,props:{},children:[{type:a,value:"Hi guys,"}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"I thought I'd extend what I'd learnt through building the DokuDrupal authentication backend by writing a secure file download script for use with Drupal 7."}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The brief I gave myself for the project was as follows:"}]},{type:a,value:k},{type:b,tag:"ul",props:{},children:[{type:b,tag:$,props:{},children:[{type:a,value:"\n        Files should be held in a location inaccessible to the web server, to avoid hotlinking"}]},{type:a,value:k},{type:b,tag:$,props:{},children:[{type:a,value:"\n        The user must be authenticated with the Drupal instance held on the server in order to use the download script"}]},{type:a,value:k},{type:b,tag:$,props:{},children:[{type:a,value:"\n        No filenames must be visible from the URLs given."}]},{type:a,value:k}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The project was actually a lot simpler than I initially thought it was going to be. A lot of the authentication code could be copied almost directly from the "},{type:b,tag:an,props:{href:"http:\u002F\u002Fn00bsys0p.co.uk\u002Fcode\u002Fdokudrupal-auth-backend\u002Flisting.php?repname=Dokuwiki+Drupal+7+Authentication+Backend",target:ao},children:[{type:a,value:"Dokuwiki auth backend"}]},{type:a,value:", as the basic method of checking authentication was just done in a PHP loop through all the users local cookies. I'll go through each of the functions I wrote individually, then show how they're used to confirm authentication."}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:b,tag:an,props:{href:"http:\u002F\u002Fn00bsys0p.co.uk\u002Fstikked\u002Findex.php\u002Fview\u002F46469766",target:ao},children:[{type:a,value:"Here's a link"}]},{type:a,value:" to the whole code without breaks in my Stikked pastebin.\n        "}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The workhorse function for the script is \"checkAuth\". It starts by finding a cookie which looks like a Drupal 7 session cookie. For any cookie it finds which matches the regex '\u002F^SESS[\\w]{32}$\u002F', it will proceed to try and find it in the Drupal sessions table. If it succeeds, it returns true. If, however, it loops through all user cookies, and none match the criteria, or are found in the database, it will return false."}]},{type:a,value:k},{type:b,tag:J,props:{className:[K]},children:[{type:b,tag:L,props:{className:[M,N]},children:[{type:b,tag:O,props:{},children:[{type:b,tag:c,props:{className:[d,P,r]},children:[{type:a,value:"\u002F**\n * ******************************************\n * ** Drupal Secure Download Script **\n * ******************************************\n *\n *  Author: Alex Shepherd \u003Cn00batnospamn00bsys0p.co.uk\u003E\n *  License: GPL2 (http:\u002F\u002Fwww.gnu.org\u002Flicenses\u002Fgpl-2.0.html)\n *\n **\u002F"}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,P,r]},children:[{type:a,value:"\u002F**\n *  ***************\n *  ** checkAuth **\n *  ***************\n *\n *  Check whether the user is currently logged into\n *  Drupal.\n *\n *  return  bool    True if user has cookies which match\n *          the Drupal database.\n **\u002F"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Initialise function variables"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aa}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ab}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ac}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ar]},children:[{type:a,value:"$_COOKIE"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Read in Drupal settings file"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'..\u002Fsites\u002Fdefault\u002Fsettings.php'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:at}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'host'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:au}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'password'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:av}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'username'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:U}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'database'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Main processing loop"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"foreach"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"as"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:V}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Ignore any cookie with anything but alphanumeric characters"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"||"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F If we are using HTTPS, the first chars of the"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Drupal cookie are SSESS. Drupal's HTTP cookies"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F start with SESS."}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F The commented line is the equivalent of the one below, which uses regex instead"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002Fif(substr($key, 0, 4) == 'SESS' &amp;&amp; strlen($key) == 36) {"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'\u002F^SESS[\\w]{32}$\u002F'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ad}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aa}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:az}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Now we have a cookie, find it in the database"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"mysql_connect"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:at}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:av}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aA}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'Critical failure. Cannot connect to database.'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"mysql_select_db"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aA}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'Critical failure. Cannot open database.'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Bear in mind that if using HTTPS, \"s.sid\" should be changed to \"s.ssid\""}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aC}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'SELECT u.uid,name FROM users u, sessions s WHERE u.uid=s.uid AND s.sid=\"'"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'\"'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ag}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"mysql_query"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"mysql_num_rows"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:V}]},{type:a,value:ax},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:"0"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ai}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"mysql_fetch_array"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ab}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'uid'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ac}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ai}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'name'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:az}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:af}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F No rows found, so on to the next cookie"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F If we have user details after the loop, user is authenticated"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ab}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aD}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:V}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:V}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ac}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aD}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,R,aF]},children:[{type:a,value:"true"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F All cookies have been checked, and all have failed"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,R,aF]},children:[{type:a,value:"false"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"\u003C"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"\u002F"}]},{type:a,value:"n00batnospamn00bsys0p"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:a,value:"co"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:a,value:"uk"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"\u003E"}]},{type:a,value:k}]}]}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The next function of note, is the one which matches the name of a file, unavailable to the outside world, except via this script. If you know any PHP at all, it's pretty simple. You fire it a number, and it tells you if there's a filename attached."}]},{type:a,value:k},{type:b,tag:J,props:{className:[K]},children:[{type:b,tag:L,props:{className:[M,N]},children:[{type:b,tag:O,props:{},children:[{type:b,tag:c,props:{className:[d,P,r]},children:[{type:a,value:"\u002F**\n *  Match the number given to a filename to download.\n *\n *  return  string  String will either be a filename or blank\n *\n **\u002F"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S,p]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Check for a single number in the input"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"\u002F^[0-9]$\u002F\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"switch"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aH}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:"1"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aI}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'UserManual.pdf'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aH}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ah]},children:[{type:a,value:"2"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:aI}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'EngineerManual.pdf'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:k}]}]}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The next function just does a meta http refresh after 3 seconds back to the referring page."}]},{type:a,value:k},{type:b,tag:J,props:{className:[K]},children:[{type:b,tag:L,props:{className:[M,N]},children:[{type:b,tag:O,props:{},children:[{type:b,tag:c,props:{className:[d,P,r]},children:[{type:a,value:"\u002F**\n *  Redirect to the referring page\n *\n * return   n\u002Fa\n **\u002F"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S,p]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"echo"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"\u003Cmeta http-equiv=\""}]},{type:a,value:"Refresh"},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\" content='\\\"3;' url=\""}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,ar]},children:[{type:a,value:"$_SERVER"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"HTTP_REFERER"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:v}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"\u003E\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:k}]}]}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"The last function just reads a file from somewhere on the filesystem on the fly, and passes it to the user."}]},{type:a,value:k},{type:b,tag:J,props:{className:[K]},children:[{type:b,tag:L,props:{className:[M,N]},children:[{type:b,tag:O,props:{},children:[{type:b,tag:c,props:{className:[d,P,r]},children:[{type:a,value:"\u002F**\n *  Pass a download link to the user.\n *\n *  return  n\u002Fa\n **\u002F"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:p}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S,p]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"Content-type: application\u002Fforce-download\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"Content-Transfer-Encoding: Binary\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"Content-length: \""}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"filesize"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"Content-disposition: attachment; filename=\\\"\""}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"basename"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"\\\"\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"readfile"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:aL},{type:b,tag:c,props:{className:[d,"interpolation"]},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]}]},{type:a,value:aL}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:k}]}]}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"Here's the code for the script file itself. It's pretty self explanatory. $dir is the folder outside the web folder's accessible area, but still accessible by Apache (for those of you running in a chroot)."}]},{type:a,value:k},{type:b,tag:J,props:{className:[K]},children:[{type:b,tag:L,props:{className:[M,N]},children:[{type:b,tag:O,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Set variables."}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aM}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'\u002Fsrv\u002Ffilerepo\u002F'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Check authentication"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,A]},children:[{type:a,value:"\"HTTP\u002F1.1 403 Forbidden\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Sanitise user input by only allowing digits"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aO}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"filter_input"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"INPUT_GET"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'file'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,R]},children:[{type:a,value:"FILTER_SANITIZE_NUMBER_INT"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"\u002F\u002F Process input and download file"}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aO}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:G}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"=="}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:x}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'HTTP\u002F1.0 404 Not Found'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,j,o]},children:[{type:a,value:"'404.php'"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aM}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:H}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:F},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aJ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:l}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:h}]},{type:a,value:k}]}]}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"As always, folks, feel free to leave me feedback in the comments, or via my contact form!"}]},{type:a,value:k},{type:b,tag:w,props:{},children:[{type:a,value:"n00b"}]}]},dir:"\u002Fposts",path:"\u002Fposts\u002Fbuilding-secure-file-download-system-drupal-7",extension:".md",readingStats:{text:"5 min read",minutes:4.345,time:260700,words:869}}}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation"," ","variable",";","operator","string","\n","(",")","keyword","single-quoted-string","function","\n  ","comment","=","\n    ","[","]","p","{","}","\n      ","double-quoted-string",".","''","'default'",",","\n\n","if","$file","header","div","nuxt-content-highlight","pre","language-php","line-numbers","code","doc-comment","\n\n    ","constant","function-definition","\n\n  ","$databases","&","!","preg_match","return","$fname","$filename","li","$sessioncookie","$uid","$username","$key","$val","continue","$result","number","$row","break","$filenum",null,"2011-09-08T14:00:00.000Z","a","_blank","checkAuth","$cookies","global","include","$dbhost","$dbpass","$dbuser","$dbname","gt","'\u002F^[\\w-]+$\u002F'","else","or","die","$sql","!=","amp","boolean","getFileName","case",":","redirectToPrevious","downloadFile","\"","$dir","exit","$getnum")));