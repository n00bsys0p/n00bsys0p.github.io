__NUXT_JSONP__("/posts/linux-and-3g-not-tough-youd-expect", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){return {data:[{post:{slug:"linux-and-3g-not-tough-youd-expect",description:"How to get 3G comms working in Linux",title:"Linux and 3G. Not as tough as you'd expect!",imagesource:"https:\u002F\u002Fcommons.wikimedia.org\u002Fwiki\u002FFile:PC_modem_3G_HSPA_DSC_0084.JPG",imagecredit:"Halvard Lundgaard",image:"2008.03.08T15:00:00_linux-and-3g-not-tough-youd-expect.png",createdAt:t,updatedAt:t,toc:[],body:{type:"root",children:[{type:b,tag:f,props:{},children:[{type:a,value:"Hi again everyone. My first wonderful nugget of Linux knowledge is to do with the emerging technology of 3G internet connections. I was set by my boss to start the development of a 3G connectivity solution for our business. I fully expected it to be an absolute cow. I was, however, pleasantly surprised."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Basically, the 3G dongle just acts like a serial modem. Issue it dialling and login commands and you're all done. Simple as that (well, pretty much!)."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The first thing which must be done is to see if the USB dongle is picked up. Slackware 10.2 had a few problems but 11 and onwards were plain sailing."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The first command you will need to use is:"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:a,value:"lsusb\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"This will ensure that your machine has detected that the dongle has been plugged in. I found that Slack 10.2 and 11 picked up the vendor and product codes (12d1 for vendor and 1003 for product) but did not pick up the manufacturer, Huawei. It doesn't matter, it just makes it more difficult for a n00b to spot that the device has been picked up correctly. A good way to check is to look at the output of lsusb before plugging in the device and after. As is obvious if the output is the same you may have some big 'ol problems, but I've never had this happen. The output you should expect from lsusb is something like the following:"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:a,value:"Bus "},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:"5"}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:"2"}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:"4"}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:u}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:r},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:u}]},{type:a,value:": ID 12d1:1003\nBus "},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:q},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:i}]},{type:a,value:": ID 0000:0000\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"A problem which you may run in to is the OS picking up the dongle as a usb storage device, as some of them contain the Windows drivers and programs on a flash ROM. The commands I used to circumvent this hurdle were as follows:"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:b,tag:d,props:{className:[e,"function"]},children:[{type:a,value:"dmesg"}]},{type:a,value:c}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Which will output a whole bunch of really ominous looking junk. You can ignore most of it (thank god!), and just look for the phrase usb-storage. If it says it has ignored it, you are fine, but if it states that usb-storage has been registered then you'll have to remove it. Do this through the following commands:"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:a,value:"rmmod options\nrmmod usb-storage\nmodprobe usbserial\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The next step for me was to add the dongle's settings to my modprobe.conf. This is located in \u002Fetc in Slackware. Add the following line to the end:"}]},{type:a,value:"\n``` bash\noptions usbserial vendor=0x12d1 product=0x1003\n```\n"},{type:b,tag:f,props:{},children:[{type:a,value:"Where 12d1 and 1003 should be replaced by the vendor and product numbers from your lsusb. I'm not entirely sure to this day what this allows to happen, but it makes it work."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Another thing I am utterly stumped by is the fact that I can't get the USB dongle to register on all 3 serial ports when hotplugged. It will only do it when I start the machine up with the USB dongle already plugged in. I'm positive it's possible to do this, and I'll update you if I ever find out how. If anybody already knows how to, feel free to let me know in the comments."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The next step is to make sure you have pppd installed. There's more than one way to complete this next section with various different programs but I only managed it with pppd. A lot of people seem to prefer wvdial, but I couldn't get it working on all of the systems I was working with."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You will need to add a file (name it whatever you want) in the directory \u002Fetc\u002Fppp\u002Fpeers and one named the same in \u002Fetc\u002Fppp\u002Fchat. If these directories don't exist, create them."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Now... You'll need to enter a whole bunch of code into both of them. If anybody has done it before, it's just like setting up a serial modem (kinda). The code I have in \u002Fetc\u002Fppp\u002Fpeers\u002F3G-connect is as follows:"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:a,value:"\u002Fdev\u002Ftts\u002FUSB0\nconnect "},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"'chat -f \u002Fetc\u002Fppp\u002Fchat\u002F3G-connect'"}]},{type:a,value:"\nusepeerdns\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"I found that a lot of the guides point you at \u002Fdev\u002FttyUSB0 through \u002Fdev\u002FttyUSB2 but old OS' won't pick these up and will instead have \u002Fdev\u002Ftts\u002FUSB0 through \u002Fdev\u002Ftts\u002FUSB2, which are located on all systems, the ttyUSB being "},{type:b,tag:v,props:{href:"http:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSymbolic_link"},children:[{type:a,value:"symbolic links"}]},{type:a,value:" anyway."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The contents of \u002Fetc\u002Fppp\u002Fchat\u002F3G-connect should read as follows (for Vodafone 3G, other providers' details can be found at the end of the code):"}]},{type:a,value:c},{type:b,tag:k,props:{className:[l]},children:[{type:b,tag:m,props:{className:[n,o]},children:[{type:b,tag:p,props:{},children:[{type:a,value:"ABORT BUSY\nABORT "},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"'NO CARRIER'"}]},{type:a,value:"\nABORT ERROR\nREPORT CONNECT\nTIMEOUT "},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:"120"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"\"\""}]},{type:a,value:" "},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"\"AT&amp;F\""}]},{type:a,value:s},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"\"ATE1\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# This command checks the signal you are connected to (defined by"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# number)"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#OK \"AT+COPS?\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# This command checks for which signals ARE available - will"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# explain the number from the last command"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#OK \"AT+COPS=?\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# List which AT commands can be used for this device"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#OK \"AT&amp;V\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# States to prefer UMTS (3G) but connect to GPRS (2G) if"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# unavailable"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#OK \"AT_OPSYS=3\""}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"# Show signal strength"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#OK \"AT+CSQ\""}]},{type:a,value:s},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"'AT+CGDCONT=1,\"IP\",\"internet\"'"}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,h]},children:[{type:a,value:"#SAY \"Calling Vodaphone GPRS\""}]},{type:a,value:"\nTIMEOUT "},{type:b,tag:d,props:{className:[e,g]},children:[{type:a,value:"60"}]},{type:a,value:s},{type:b,tag:d,props:{className:[e,j]},children:[{type:a,value:"\"ATD*99***1#\""}]},{type:a,value:"\nCONNECT c\n"}]}]}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"The reason I have some commands hashed out is that they caused conflicts with my system. Some can be pretty useful while debugging the system, so by all means unhash and give them a shot."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Other UK 3G providers' connection details can be found "},{type:b,tag:v,props:{href:"http:\u002F\u002Fwww.filesaveas.com\u002Fgprs.html"},children:[{type:a,value:"here"}]},{type:a,value:"."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"Now all you will need to do to connect to the internet is to type:"}]},{type:a,value:"\n``` bash\npppd call 3G-connect\n```\n"},{type:b,tag:f,props:{},children:[{type:a,value:"Just replace 3G-connect with whatever you called the file."}]},{type:a,value:c},{type:b,tag:f,props:{},children:[{type:a,value:"You will still need to replace your DNS settings with the new ones and add a default gateway. They are listed at the end of \u002Fvar\u002Flog\u002Fmessages, but an easier way to do it is just overwrite your \u002Fetc\u002Fresolv.conf with \u002Fetc\u002Fppp\u002Fresolv.conf, which contains your new DNS settings. I have written a little bash script to do this. It's really badly written, but it works for what I need it for. It runs as follows:"}]},{type:a,value:"\n``` bash\n#!\u002Fusr\u002Fbin\u002Fenv bash\nexport GATEWAY=\"10.64.64.64\"\nexport DNSCONFIG=\"\u002Fetc\u002Fresolv.conf\"\nexport IFACE=\"ppp0\"\nexport PPPDNS=\"\u002Fetc\u002Fppp\u002Fresolv.conf\"\nexport PPPRUN=\"pppd call\"\nexport PPPFILE=\"3G-connect\"\necho \"Connecting to UMTS\u002FGPRS network\"\n$PPPRUN $PPPFILE\nsleep 8\necho;echo\necho \"Updating $DNSCONFIG.\"\necho;echo\necho \"Checking $PPPDNS\"\ntail -n2 $PPPDNS\ncat $PPPDNS &gt; $DNSCONFIG\necho \"Addng default gateway of $GATEWAY to $IFACE\"\nroute add default gw $GATEWAY $IFACE\necho;echo\necho \"Connection complete\"\n```\n"},{type:b,tag:f,props:{},children:[{type:a,value:"Anyway... Hopefully that's all the info you'll need to get yourself up and running on the very futuristic world of 3G connectivity. All in all, it's not all that fantastic... Unreliable speed, it's expensive, and it's impossible to get a static IP without forking out thousands of pounds for a dedicated server-side AP. Still useful when my Interwebz are down and it seems to impress our customers when we tell them they can have GPRS connectivity on their device. Now I'm going to go and carry on trying to get GIMP installed on my lappy. 3 hours so far!"}]}]},dir:"\u002Fposts",path:"\u002Fposts\u002Flinux-and-3g-not-tough-youd-expect",extension:".md",readingStats:{text:"6 min read",minutes:5.73,time:343800,words:1146}}}],fetch:{},mutations:void 0}}("text","element","\n","span","token","p","number","comment","1","string","div","nuxt-content-highlight","pre","language-bash","line-numbers","code"," Device ",": ID 0000:0000\nBus ","\nOK ","2008-03-08T15:00:00.000Z","3","a")));